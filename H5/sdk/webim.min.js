!function(e){var t={};function n(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(o,i,function(t){return e[t]}.bind(null,i));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(e){e.exports={Version:"1.7.3"}},function(e,t,n){"use strict";n.r(t);var o=n(0);window.Long=function(){function e(e,t,n){this.low=0|e,this.high=0|t,this.unsigned=!!n}function t(e){return!0===(e&&e.__isLong__)}e.prototype.__isLong__,Object.defineProperty(e.prototype,"__isLong__",{value:!0,enumerable:!1,configurable:!1}),e.isLong=t;var n={},o={};function i(e,t){var i,r,u;return t?(u=0<=(e>>>=0)&&e<256)&&(r=o[e])?r:(i=s(e,(0|e)<0?-1:0,!0),u&&(o[e]=i),i):(u=-128<=(e|=0)&&e<128)&&(r=n[e])?r:(i=s(e,e<0?-1:0,!1),u&&(n[e]=i),i)}function r(e,t){if(isNaN(e)||!isFinite(e))return t?m:d;if(t){if(e<0)return m;if(e>=p)return _}else{if(e<=-f)return E;if(e+1>=f)return M}return e<0?r(-e,t).neg():s(e%l|0,e/l|0,t)}function s(t,n,o){return new e(t,n,o)}e.fromInt=i,e.fromNumber=r,e.fromBits=s;var u=Math.pow;function a(e,t,n){if(0===e.length)throw Error("empty string");if("NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return d;if("number"==typeof t?(n=t,t=!1):t=!!t,(n=n||10)<2||36<n)throw RangeError("radix");var o;if((o=e.indexOf("-"))>0)throw Error("interior hyphen");if(0===o)return a(e.substring(1),t,n).neg();for(var i=r(u(n,8)),s=d,c=0;c<e.length;c+=8){var l=Math.min(8,e.length-c),p=parseInt(e.substring(c,c+l),n);if(l<8){var f=r(u(n,l));s=s.mul(f).add(r(p))}else s=(s=s.mul(i)).add(r(p))}return s.unsigned=t,s}function c(t){return t instanceof e?t:"number"==typeof t?r(t):"string"==typeof t?a(t):s(t.low,t.high,t.unsigned)}e.fromString=a,e.fromValue=c;var l=4294967296,p=l*l,f=p/2,g=i(1<<24),d=i(0);e.ZERO=d;var m=i(0,!0);e.UZERO=m;var h=i(1);e.ONE=h;var I=i(1,!0);e.UONE=I;var y=i(-1);e.NEG_ONE=y;var M=s(-1,2147483647,!1);e.MAX_VALUE=M;var _=s(-1,-1,!0);e.MAX_UNSIGNED_VALUE=_;var E=s(0,-2147483648,!1);e.MIN_VALUE=E;var T=e.prototype;return T.toInt=function(){return this.unsigned?this.low>>>0:this.low},T.toNumber=function(){return this.unsigned?(this.high>>>0)*l+(this.low>>>0):this.high*l+(this.low>>>0)},T.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(E)){var t=r(e),n=this.div(t),o=n.mul(t).sub(this);return n.toString(e)+o.toInt().toString(e)}return"-"+this.neg().toString(e)}for(var i=r(u(e,6),this.unsigned),s=this,a="";;){var c=s.div(i),l=(s.sub(c.mul(i)).toInt()>>>0).toString(e);if((s=c).isZero())return l+a;for(;l.length<6;)l="0"+l;a=""+l+a}},T.getHighBits=function(){return this.high},T.getHighBitsUnsigned=function(){return this.high>>>0},T.getLowBits=function(){return this.low},T.getLowBitsUnsigned=function(){return this.low>>>0},T.getNumBitsAbs=function(){if(this.isNegative())return this.eq(E)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&0==(e&1<<t);t--);return 0!=this.high?t+33:t+1},T.isZero=function(){return 0===this.high&&0===this.low},T.isNegative=function(){return!this.unsigned&&this.high<0},T.isPositive=function(){return this.unsigned||this.high>=0},T.isOdd=function(){return 1==(1&this.low)},T.isEven=function(){return 0==(1&this.low)},T.equals=function(e){return t(e)||(e=c(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&this.high===e.high&&this.low===e.low},T.eq=T.equals,T.notEquals=function(e){return!this.eq(e)},T.neq=T.notEquals,T.lessThan=function(e){return this.comp(e)<0},T.lt=T.lessThan,T.lessThanOrEqual=function(e){return this.comp(e)<=0},T.lte=T.lessThanOrEqual,T.greaterThan=function(e){return this.comp(e)>0},T.gt=T.greaterThan,T.greaterThanOrEqual=function(e){return this.comp(e)>=0},T.gte=T.greaterThanOrEqual,T.compare=function(e){if(t(e)||(e=c(e)),this.eq(e))return 0;var n=this.isNegative(),o=e.isNegative();return n&&!o?-1:!n&&o?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},T.comp=T.compare,T.negate=function(){return!this.unsigned&&this.eq(E)?E:this.not().add(h)},T.neg=T.negate,T.add=function(e){t(e)||(e=c(e));var n=this.high>>>16,o=65535&this.high,i=this.low>>>16,r=65535&this.low,u=e.high>>>16,a=65535&e.high,l=e.low>>>16,p=0,f=0,g=0,d=0;return g+=(d+=r+(65535&e.low))>>>16,f+=(g+=i+l)>>>16,p+=(f+=o+a)>>>16,p+=n+u,s((g&=65535)<<16|(d&=65535),(p&=65535)<<16|(f&=65535),this.unsigned)},T.subtract=function(e){return t(e)||(e=c(e)),this.add(e.neg())},T.sub=T.subtract,T.multiply=function(e){if(this.isZero())return d;if(t(e)||(e=c(e)),e.isZero())return d;if(this.eq(E))return e.isOdd()?E:d;if(e.eq(E))return this.isOdd()?E:d;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(g)&&e.lt(g))return r(this.toNumber()*e.toNumber(),this.unsigned);var n=this.high>>>16,o=65535&this.high,i=this.low>>>16,u=65535&this.low,a=e.high>>>16,l=65535&e.high,p=e.low>>>16,f=65535&e.low,m=0,h=0,I=0,y=0;return I+=(y+=u*f)>>>16,h+=(I+=i*f)>>>16,I&=65535,h+=(I+=u*p)>>>16,m+=(h+=o*f)>>>16,h&=65535,m+=(h+=i*p)>>>16,h&=65535,m+=(h+=u*l)>>>16,m+=n*f+o*p+i*l+u*a,s((I&=65535)<<16|(y&=65535),(m&=65535)<<16|(h&=65535),this.unsigned)},T.mul=T.multiply,T.divide=function(e){if(t(e)||(e=c(e)),e.isZero())throw Error("division by zero");if(this.isZero())return this.unsigned?m:d;var n,o,i;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return m;if(e.gt(this.shru(1)))return I;i=m}else{if(this.eq(E))return e.eq(h)||e.eq(y)?E:e.eq(E)?h:(n=this.shr(1).div(e).shl(1)).eq(d)?e.isNegative()?h:y:(o=this.sub(e.mul(n)),i=n.add(o.div(e)));if(e.eq(E))return this.unsigned?m:d;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();i=d}for(o=this;o.gte(e);){n=Math.max(1,Math.floor(o.toNumber()/e.toNumber()));for(var s=Math.ceil(Math.log(n)/Math.LN2),a=s<=48?1:u(2,s-48),l=r(n),p=l.mul(e);p.isNegative()||p.gt(o);)p=(l=r(n-=a,this.unsigned)).mul(e);l.isZero()&&(l=h),i=i.add(l),o=o.sub(p)}return i},T.div=T.divide,T.modulo=function(e){return t(e)||(e=c(e)),this.sub(this.div(e).mul(e))},T.mod=T.modulo,T.not=function(){return s(~this.low,~this.high,this.unsigned)},T.and=function(e){return t(e)||(e=c(e)),s(this.low&e.low,this.high&e.high,this.unsigned)},T.or=function(e){return t(e)||(e=c(e)),s(this.low|e.low,this.high|e.high,this.unsigned)},T.xor=function(e){return t(e)||(e=c(e)),s(this.low^e.low,this.high^e.high,this.unsigned)},T.shiftLeft=function(e){return t(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?s(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):s(0,this.low<<e-32,this.unsigned)},T.shl=T.shiftLeft,T.shiftRight=function(e){return t(e)&&(e=e.toInt()),0==(e&=63)?this:e<32?s(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):s(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},T.shr=T.shiftRight,T.shiftRightUnsigned=function(e){if(t(e)&&(e=e.toInt()),0==(e&=63))return this;var n=this.high;return e<32?s(this.low>>>e|n<<32-e,n>>>e,this.unsigned):s(32===e?n:n>>>e-32,0,this.unsigned)},T.shru=T.shiftRightUnsigned,T.toSigned=function(){return this.unsigned?s(this.low,this.high,!1):this},T.toUnsigned=function(){return this.unsigned?this:s(this.low,this.high,!0)},T.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},T.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24&255,255&e,e>>>8&255,e>>>16&255,e>>>24&255]},T.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24&255,e>>>16&255,e>>>8&255,255&e,t>>>24&255,t>>>16&255,t>>>8&255,255&t]},e}(),"function"!=typeof Array.prototype.forEach&&(Array.prototype.forEach=function(e){for(var t=0;t<this.length;t++)e.apply(this,[this[t],t,this])});var i={},r={login:function(e,t,n){},syncMsgs:function(e,t){},getC2CHistoryMsgs:function(e,t,n){},syncGroupMsgs:function(e,t,n){},sendMsg:function(e,t,n){},logout:function(e,t){},setAutoRead:function(e,t,n){},getProfilePortrait:function(e,t,n){},setProfilePortrait:function(e,t,n){},applyAddFriend:function(e,t,n){},getPendency:function(e,t,n){},deletePendency:function(e,t,n){},responseFriend:function(e,t,n){},getAllFriend:function(e,t,n){},deleteFriend:function(e,t,n){},addBlackList:function(e,t,n){},getBlackList:function(e,t,n){},deleteBlackList:function(e,t,n){},uploadPic:function(e,t,n){},createGroup:function(e,t,n){},applyJoinGroup:function(e,t,n){},handleApplyJoinGroup:function(e,t,n){},deleteApplyJoinGroupPendency:function(e,t,n){},quitGroup:function(e,t,n){},getGroupPublicInfo:function(e,t,n){},getGroupInfo:function(e,t,n){},modifyGroupBaseInfo:function(e,t,n){},destroyGroup:function(e,t,n){},getJoinedGroupListHigh:function(e,t,n){},getGroupMemberInfo:function(e,t,n){},addGroupMember:function(e,t,n){},modifyGroupMember:function(e,t,n){},forbidSendMsg:function(e,t,n){},deleteGroupMember:function(e,t,n){},getPendencyGroup:function(e,t,n){},getPendencyReport:function(e,t,n){},getPendencyGroupRead:function(e,t,n){},sendCustomGroupNotify:function(e,t,n){},Msg:function(e,t,n,o,i,r,s,u,a){},MsgStore:{sessMap:function(){return{}},sessCount:function(){return 0},sessByTypeId:function(e,t){return{}},delSessByTypeId:function(e,t){return!0},resetCookieAndSyncFlag:function(){},downloadMap:{}}};window.webim=r,function(e){var t={VERSION:o,APPID:"537048168",PLAATFORM:"10"},n=!0,r=!0,s={FORMAL:{COMMON:"https://webim.tim.qq.com",PIC:"https://pic.tim.qq.com"},TEST:{COMMON:"https://test.tim.qq.com",PIC:"https://pic.tim.qq.com"}},u={},a=!1,c="openim",l="group_open_http_svc",p="sns",f="profile",g="recentcontact",d="openpic",m="group_open_http_noauth_svc",h="group_open_long_polling_http_noauth_svc",I="imopenstat",y="recentcontact",M="webim",_={openim:"v4",group_open_http_svc:"v4",sns:"v4",profile:"v4",recentcontact:"v4",openpic:"v4",group_open_http_noauth_svc:"v1",group_open_long_polling_http_noauth_svc:"v1",imopenstat:"v4",webim:"v3"},E={login:1,pic_up:3,apply_join_group:9,create_group:10,longpolling:18,send_group_msg:19,sendmsg:20},T={C2C:"C2C",GROUP:"GROUP"},A={OK:"OK",FAIL:"FAIL"},C={TEXT:"TIMTextElem",FACE:"TIMFaceElem",IMAGE:"TIMImageElem",CUSTOM:"TIMCustomElem",SOUND:"TIMSoundElem",FILE:"TIMFileElem",LOCATION:"TIMLocationElem",GROUP_TIP:"TIMGroupTipElem"},v={ORIGIN:1,LARGE:2,SMALL:3},S={JPG:1,JPEG:1,GIF:2,PNG:3,BMP:4,UNKNOWN:255},F={RAW_DATA:0,BASE64_DATA:1},G="10001",N="grouptalk.c2c.qq.com",b=2106,O=2107,R={IMAGE:1,FILE:2,SHORT_VIDEO:3,SOUND:4},w={APP_VERSION:"2.1",SERVER_VERSION:1},L={C2C:1,GROUP_COMMON:3,GROUP_TIP:4,GROUP_SYSTEM:5,GROUP_TIP2:6,FRIEND_NOTICE:7,PROFILE_NOTICE:8,C2C_COMMON:9,C2C_EVENT:10},P={COMMON:0},U=92,k=96,D={COMMON:0,LOVEMSG:1,TIP:2,REDPACKET:3},q=1,x=3,B={JOIN:1,QUIT:2,KICK:3,SET_ADMIN:4,CANCEL_ADMIN:5,MODIFY_GROUP_INFO:6,MODIFY_MEMBER_INFO:7},K={FACE_URL:1,NAME:2,OWNER:3,NOTIFICATION:4,INTRODUCTION:5},H={JOIN_GROUP_REQUEST:1,JOIN_GROUP_ACCEPT:2,JOIN_GROUP_REFUSE:3,KICK:4,DESTORY:5,CREATE:6,INVITED_JOIN_GROUP_REQUEST:7,QUIT:8,SET_ADMIN:9,CANCEL_ADMIN:10,REVOKE:11,READED:15,CUSTOM:255,INVITED_JOIN_GROUP_REQUEST_AGREE:12},J={FRIEND_ADD:1,FRIEND_DELETE:2,PENDENCY_ADD:3,PENDENCY_DELETE:4,BLACK_LIST_ADD:5,BLACK_LIST_DELETE:6,PENDENCY_REPORT:7,FRIEND_UPDATE:8},V=1,z={INIT:-1,ON:0,RECONNECT:1,OFF:9999},Y=14,j=z.INIT,X=!1,W=0,Q=6e4,Z=null,$=0,ee=0,te=null,ne=null,oe=0,ie=[],re=null,se={sdkAppID:null,appIDAt3rd:null,accountType:null,identifier:null,tinyid:null,identifierNick:null,userSig:null,a2:null,contentType:"json",apn:1},ue={},ae=0,ce={},le=0,pe=[],fe=[],ge=[],de=null,me={downloadMap:{}},he={"[惊讶]":0,"[撇嘴]":1,"[色]":2,"[发呆]":3,"[得意]":4,"[流泪]":5,"[害羞]":6,"[闭嘴]":7,"[睡]":8,"[大哭]":9,"[尴尬]":10,"[发怒]":11,"[调皮]":12,"[龇牙]":13,"[微笑]":14,"[难过]":15,"[酷]":16,"[冷汗]":17,"[抓狂]":18,"[吐]":19,"[偷笑]":20,"[可爱]":21,"[白眼]":22,"[傲慢]":23,"[饿]":24,"[困]":25,"[惊恐]":26,"[流汗]":27,"[憨笑]":28,"[大兵]":29,"[奋斗]":30,"[咒骂]":31,"[疑问]":32,"[嘘]":33,"[晕]":34},Ie={},ye=new function(){this.formatTimeStamp=function(e,t){if(!e)return 0;var n;t=t||"yyyy-MM-dd hh:mm:ss";var o=new Date(1e3*e),i={"M+":o.getMonth()+1,"d+":o.getDate(),"h+":o.getHours(),"m+":o.getMinutes(),"s+":o.getSeconds()};for(var r in n=/(y+)/.test(t)?t.replace(RegExp.$1,(o.getFullYear()+"").substr(4-RegExp.$1.length)):t,i)new RegExp("("+r+")").test(n)&&(n=n.replace(RegExp.$1,1==RegExp.$1.length?i[r]:("00"+i[r]).substr((""+i[r]).length)));return n},this.groupTypeEn2Ch=function(e){var t=null;switch(e){case"Public":t="公开群";break;case"ChatRoom":t="聊天室";break;case"Private":t="私有群";break;case"AVChatRoom":t="直播聊天室";break;default:t=e}return t},this.groupTypeCh2En=function(e){var t=null;switch(e){case"公开群":t="Public";break;case"聊天室":t="ChatRoom";break;case"私有群":t="Private";break;case"直播聊天室":t="AVChatRoom";break;default:t=e}return t},this.groupRoleEn2Ch=function(e){var t=null;switch(e){case"Member":t="成员";break;case"Admin":t="管理员";break;case"Owner":t="群主";break;default:t=e}return t},this.groupRoleCh2En=function(e){var t=null;switch(e){case"成员":t="Member";break;case"管理员":t="Admin";break;case"群主":t="Owner";break;default:t=e}return t},this.groupMsgFlagEn2Ch=function(e){var t=null;switch(e){case"AcceptAndNotify":t="接收并提示";break;case"AcceptNotNotify":t="接收不提示";break;case"Discard":t="屏蔽";break;default:t=e}return t},this.groupMsgFlagCh2En=function(e){var t=null;switch(e){case"接收并提示":t="AcceptAndNotify";break;case"接收不提示":t="AcceptNotNotify";break;case"屏蔽":t="Discard";break;default:t=e}return t},this.formatText2Html=function(e){var t=e;return t&&(t=(t=(t=this.xssFilter(t)).replace(/ /g,"&nbsp;")).replace(/\n/g,"<br/>")),t},this.formatHtml2Text=function(e){var t=e;return t&&(t=(t=t.replace(/&nbsp;/g," ")).replace(/<br\/>/g,"\n")),t},this.getStrBytes=function(e){if(null==e||void 0===e)return 0;if("string"!=typeof e)return 0;var t,n,o,i=0;for(n=0,o=e.length;n<o;n++)i+=(t=e.charCodeAt(n))<=127?1:t<=2047?2:t<=65535?3:4;return i},this.xssFilter=function(e){return r&&(e=(e=(e=(e=e.toString()).replace(/[<]/g,"&lt;")).replace(/[>]/g,"&gt;")).replace(/"/g,"&quot;")),e},this.trimStr=function(e){return e?(e=e.toString()).replace(/(^\s*)|(\s*$)/g,""):""},this.validNumber=function(e){return(e=e.toString()).match(/(^\d{1,8}$)/g)},this.getReturnError=function(e,t){return t||(t=-100),{ActionStatus:A.FAIL,ErrorCode:t,ErrorInfo:e+"["+t+"]"}},this.setCookie=function(e,t,n,o,i){var r=new Date;r.setTime(r.getTime()+1e3*n),document.cookie=e+"="+escape(t)+";expires="+r.toGMTString()},this.getCookie=function(e){var t=document.cookie.match(new RegExp("(^| )"+e+"=([^;]*)(;|$)"));return null!=t?unescape(t[2]):null},this.delCookie=function(e){var t=new Date;t.setTime(t.getTime()-1);var n=this.getCookie(e);null!=n&&(document.cookie=e+"="+escape(n)+";expires="+t.toGMTString())},this.getQueryString=function(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),n=window.location.search.substr(1).match(t);return null!=n?unescape(n[2]):null},this.isIE=function(e){var t=document.createElement("b");return t.innerHTML="\x3c!--[if IE "+e+"]><i></i><![endif]--\x3e",1===t.getElementsByTagName("i").length},this.getBrowserInfo=function(){var e,t={},n=navigator.userAgent.toLowerCase();return Me.info("navigator.userAgent="+n),(e=n.match(/msie ([\d.]+)/))?t.ie=e[1]:(e=n.match(/firefox\/([\d.]+)/))?t.firefox=e[1]:(e=n.match(/chrome\/([\d.]+)/))?t.chrome=e[1]:(e=n.match(/opera.([\d.]+)/))?t.opera=e[1]:(e=n.match(/version\/([\d.]+).*safari/))&&(t.safari=e[1]),t.ie?(n.match(/trident\/(\d)\./)&&6==n.match(/trident\/(\d)\./)[1]&&(t.ie=10),{type:"ie",ver:t.ie}):t.firefox?{type:"firefox",ver:t.firefox}:t.chrome?{type:"chrome",ver:t.chrome}:t.opera?{type:"opera",ver:t.opera}:t.safari?{type:"safari",ver:t.safari}:{type:"unknow",ver:-1}},this.replaceObject=function(e,t){for(var n in t)if(e[n])if(t[e[n]]=t[n],delete t[n],t[e[n]]instanceof Array)for(var o=t[e[n]].length,i=0;i<o;i++)t[e[n]][i]=this.replaceObject(e,t[e[n]][i]);else"object"==typeof t[e[n]]&&(t[e[n]]=this.replaceObject(e,t[e[n]]));return t}},Me=new function(){var e=!0;this.setOn=function(t){e=t},this.getOn=function(){return e},this.error=function(t){try{e&&console.error(t)}catch(e){}},this.warn=function(t){try{e&&console.warn(t)}catch(e){}},this.info=function(t){try{e&&console.info(t)}catch(e){}},this.debug=function(t){try{e&&console.debug(t)}catch(e){}}},_e=function(e){return e||(e=new Date),Math.round(e.getTime()/1e3)},Ee=function(){return le?le+=1:le=Math.round(1e7*Math.random()),le},Te=function(){return Math.round(4294967296*Math.random())},Ae=function(e,t,n,o,i,r,s,u){var a=function(){var e=null;if(window.XMLHttpRequest)e=new XMLHttpRequest;else try{e=new ActiveXObject("Msxml2.XMLHTTP")}catch(t){try{e=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){return null}}return e}();if(!a){"创建请求失败";var c=ye.getReturnError("创建请求失败",-1);return Me.error("创建请求失败"),void(u&&u(c))}ce[++ae]=a,a.open(e,t,!0),a.onreadystatechange=function(){4==a.readyState&&(ce[ae]=null,200==a.status?(s&&s(a.responseText),a=null,W=0):(a=null,setTimeout(function(){var e=ye.getReturnError("请求服务器失败,请检查你的网络是否正常",-2);r&&de&&de(e),u&&u(e)},16)))},a.setRequestHeader("Content-Type",i),o||(o=15e3),o&&(a.timeout=o,a.ontimeout=function(e){a=null}),a.overrideMimeType,a.send(n)},Ce=function(){return se.sdkAppID&&se.identifier},ve=function(e,t){if(!Ce()){if(t){var n=ye.getReturnError("请登录",-4);e&&e(n)}return!1}return!0},Se=function(){return n},Fe=function(e,n,o,i){var r=s;r=Se()?s.FORMAL.COMMON:s.TEST.COMMON,e==d&&(r=Se()?s.FORMAL.PIC:s.TEST.PIC);var u=r+"/"+_[e]+"/"+e+"/"+n+"?websdkappid="+t.APPID+"&v="+t.VERSION+"&platform="+t.PLAATFORM;if(Ce()){if("login"==n||"accesslayer"==n)u+="&identifier="+encodeURIComponent(se.identifier)+"&usersig="+se.userSig;else if(se.tinyid&&se.a2)u+="&tinyid="+se.tinyid+"&a2="+se.a2;else if(i)return Me.error("tinyid或a2为空["+e+"]["+n+"]"),i(ye.getReturnError("tinyid或a2为空["+e+"]["+n+"]",-5)),!1;u+="&contenttype="+se.contentType}return u+="&sdkappid="+se.sdkAppID+"&accounttype="+se.accountType+"&apn="+se.apn+"&reqtime="+_e()},Ge=function(e,t,n){var o=null;return re&&ie[0]?o="http://"+ie[0]+"/asn.com/stddownload_common_file?authkey="+re+"&bid="+G+"&subbid="+se.sdkAppID+"&fileid="+e+"&filetype="+O+"&openid="+t+"&ver=0&filename="+encodeURIComponent(n):Me.error("拼接文件下载url不报错：ip或者authkey为空"),me.downloadMap["uuid_"+e]=o,o},Ne=function(e,t,n,o,i,r,s){var u={From_Account:t,To_Account:i,os_platform:10,Timestamp:_e().toString(),Random:Te().toString(),request_info:[{busi_id:r,download_flag:o,type:s,uuid:e,version:w.SERVER_VERSION,auth_key:re,ip:ie[0]}]};ze(u,function(e){0==e.error_code&&e.response_info&&(me.downloadMap["uuid_"+u.uuid]=e.response_info.url),onAppliedDownloadUrl&&onAppliedDownloadUrl({uuid:u.uuid,url:e.response_info.url,maps:me.downloadMap})},function(e){Me.error("获取下载地址失败",u.uuid)})},be=function(){!function(){for(var e in ce){var t=ce[e];t&&(t.abort(),ce[ae]=null)}ae=0,ce={}}(),se={sdkAppID:null,appIDAt3rd:null,accountType:null,identifier:null,identifierNick:null,userSig:null,contentType:"json",apn:1},ue={},le=0,ee=0,te=null,ge=[],$e.clear(),Ze.clear(),Z=null},Oe=function(e,n,o){if("longpolling"!=e||60008!=n&&91101!=n){var i=E[e];if(i){var r=_e(),s=null,u={Code:n,ErrMsg:o};if(se.a2?s=se.a2.substring(0,10)+"_"+r+"_"+Te():se.userSig&&(s=se.userSig.substring(0,10)+"_"+r+"_"+Te()),s){var a={UniqKey:s,EventId:i,ReportTime:r,MsgCmdErrorCode:u};if("login"==e){var c=[];c.push(a),Je({EvtItems:c,MainVersion:t.VERSION,Version:"0"},function(e){c=null},function(e){c=null})}else{if(ge.push(a),ge.length>=20)Je({EvtItems:ge,MainVersion:t.VERSION,Version:"0"},function(e){ge=[]},function(e){ge=[]})}}}}},Re=function(e){Ye.apiCall(M,"accesslayer",{},function(t){0===t.ErrorCode&&1===t.WebImAccessLayer&&(s.FORMAL.COMMON="https://events.tim.qq.com"),e()},function(){e()})},we=function(e,t){Ye.apiCall(c,"login",{State:"Online"},function(n){if(n.TinyId)se.tinyid=n.TinyId;else if(t)return void t(ye.getReturnError("TinyId is empty",-10));if(n.A2Key)se.a2=n.A2Key;else if(t)return void t(ye.getReturnError("A2Key is empty",-11));var o={From_Account:se.identifier,To_Account:[se.identifier],LastStandardSequence:0,TagList:["Tag_Profile_IM_Nick","Tag_Profile_IM_Image"]};Ke(o,function(t){var n,o;if(t.UserProfileItem&&t.UserProfileItem.length>0)for(var i in t.UserProfileItem)for(var r in t.UserProfileItem[i].ProfileItem)switch(t.UserProfileItem[i].ProfileItem[r].Tag){case"Tag_Profile_IM_Nick":(n=t.UserProfileItem[i].ProfileItem[r].Value)&&(se.identifierNick=n);break;case"Tag_Profile_IM_Image":(o=t.UserProfileItem[i].ProfileItem[r].Value)&&(se.headurl=o)}e&&e(se.identifierNick,se.headurl)},t)},t)},Le=function(e,t,n){if(!ve(n,!1))return be(),void(t&&t({ActionStatus:A.OK,ErrorCode:0,ErrorInfo:"logout success"}));"all"==e?Ye.apiCall(c,"logout",{},function(e){be(),t&&t(e)},n):Ye.apiCall(c,"longpollinglogout",{LongPollingId:Z},function(e){be(),t&&t(e)},n)},Pe=function(e,t,o){(n||"undefined"==typeof stopPolling||1!=stopPolling)&&ve(o,!0)&&Ye.apiCall(c,"longpolling",e,t,o,Q,!0)},Ue=function(e,t,n,o){ve(o,!0)&&Ye.apiCall(c,"getmsg",{Cookie:e,SyncFlag:t},function(e){if(e.MsgList&&e.MsgList.length)for(var t in e.MsgList)pe.push(e.MsgList[t]);1==e.SyncFlag?Ue(e.Cookie,e.SyncFlag,n,o):(e.MsgList=pe,pe=[],n&&n(e))},o)},ke=function(e,t,n,o){if(ve(o,!0)){var i=[];for(var r in t){var s={To_Account:t[r].toAccount,LastedMsgTime:t[r].lastedMsgTime};i.push(s)}Ye.apiCall(c,"msgreaded",{C2CMsgReaded:{Cookie:e,C2CMsgReadedItem:i}},n,o)}},De=function(e,t,n){ve(n,!0)&&Ye.apiCall(c,"getroammsg",e,function(o){var i=e.MaxCnt,r=o.Complete,s=o.MaxCnt,u=o.MsgKey,a=o.LastMsgTime;if(o.MsgList&&o.MsgList.length)for(var c in o.MsgList)fe.push(o.MsgList[c]);var l=null;0==r&&s<i&&(l={Peer_Account:e.Peer_Account,MaxCnt:i-s,LastMsgTime:a,MsgKey:u}),l?De(l,t,n):(o.MsgList=fe,fe=[],t&&t(o))},n)},qe=function(e,t,n){ve(n,!0)&&Ye.apiCall(l,"get_joined_group_list",{Member_Account:e.Member_Account,Limit:e.Limit,Offset:e.Offset,GroupType:e.GroupType,ResponseFilter:{GroupBaseInfoFilter:e.GroupBaseInfoFilter,SelfInfoFilter:e.SelfInfoFilter}},t,n)},xe=function(e,t,n){ve(n,!0)&&Ye.apiCall(l,"msg_read_report",{GroupId:e.GroupId,MsgReadedSeq:e.MsgReadedSeq},t,n)},Be=function(e){var t=[];if(e.Fail_Account&&e.Fail_Account.length&&(t=e.Fail_Account),e.Invalid_Account&&e.Invalid_Account.length)for(var n in e.Invalid_Account)t.push(e.Invalid_Account[n]);if(t.length)for(var o in e.ActionStatus=A.FAIL,e.ErrorCode=99999,e.ErrorInfo="",t){var i=t[o];for(var r in e.ResultItem)if(e.ResultItem[r].To_Account==i){var s=e.ResultItem[r].ResultCode;e.ResultItem[r].ResultInfo="["+s+"]"+e.ResultItem[r].ResultInfo,e.ErrorInfo+=e.ResultItem[r].ResultInfo+"\n";break}}return e},Ke=function(e,t,n){e.To_Account.length>100&&(e.To_Account.length=100,Me.error("获取用户资料人数不能超过100人")),ve(n,!0)&&Ye.apiCall(f,"portrait_get",{From_Account:se.identifier,To_Account:e.To_Account,TagList:e.TagList},function(e){var o=[];if(e.Fail_Account&&e.Fail_Account.length&&(o=e.Fail_Account),e.Invalid_Account&&e.Invalid_Account.length)for(var i in e.Invalid_Account)o.push(e.Invalid_Account[i]);if(o.length)for(var r in e.ActionStatus=A.FAIL,e.ErrorCode=99999,e.ErrorInfo="",o){var s=o[r];for(var u in e.UserProfileItem)if(e.UserProfileItem[u].To_Account==s){var a=e.UserProfileItem[u].ResultCode;e.UserProfileItem[u].ResultInfo="["+a+"]"+e.UserProfileItem[u].ResultInfo,e.ErrorInfo+="账号:"+s+","+e.UserProfileItem[u].ResultInfo+"\n";break}}e.ActionStatus==A.FAIL?n&&n(e):t&&t(e)},n)},He=function(e,t,n){var o;ve(n,!0)&&(o=Se()?"pic_up":"pic_up_test",Ye.apiCall(d,o,{App_Version:w.APP_VERSION,From_Account:se.identifier,To_Account:e.To_Account,Seq:e.Seq,Timestamp:e.Timestamp,Random:e.Random,File_Str_Md5:e.File_Str_Md5,File_Size:e.File_Size,File_Type:e.File_Type,Server_Ver:w.SERVER_VERSION,Auth_Key:re,Busi_Id:e.Busi_Id,PkgFlag:e.PkgFlag,Slice_Offset:e.Slice_Offset,Slice_Size:e.Slice_Size,Slice_Data:e.Slice_Data,content_type:"application/x-www-form-urlencoded"},t,n))},Je=function(e,t,n){ve(n,!0)&&Ye.apiCall(I,"web_report",e,t,n)},Ve=function(e,t,n){ve(n,!0)&&Ye.apiCall(c,"getlongpollingid",{},function(e){t&&t(e)},n)},ze=function(e,t,n){Ye.apiCall(d,"apply_download",e,t,n)};u=ye.getBrowserInfo(),Me.info("BROWSER_INFO: type="+u.type+", ver="+u.ver),"ie"==u.type&&parseInt(u.ver)<10&&(a=!0);var Ye=0==a?new function(){var e=null;this.init=function(t,n,o){t&&(e=t)},this.callBack=function(t){e&&e(t)},this.clear=function(){e=null},this.apiCall=function(e,t,n,o,i,r,s){var u=Fe(e,t,0,i);if(0!=u){var a=n.content_type?n.content_type:"application/x-www-form-urlencoded";!function(e,t,n,o,i,r,s,u){Ae(e,t,JSON.stringify(n),o,i,r,function(e){var t=null;e&&(t=JSON.parse(e)),r&&de&&de(t),s&&s(t)},u)}("POST",u,n,r,a,s,function(r){var s=null,a="";"pic_up"==t&&(n.Slice_Data="");var c="\n request url: \n"+u+"\n request body: \n"+JSON.stringify(n)+"\n response: \n"+JSON.stringify(r);r.ActionStatus==A.OK?(Me.info("["+e+"]["+t+"]success: "+c),o&&o(r),s=0,a=""):(s=r.ErrorCode,a=r.ErrorInfo,i&&(r.SrcErrorInfo=r.ErrorInfo,r.ErrorInfo="["+e+"]["+t+"]failed: "+c,"longpolling"==t&&60008==r.ErrorCode||Me.error(r.ErrorInfo),i(r))),Oe(t,s,a)},function(e){i&&i(e),Oe(t,e.ErrorCode,e.ErrorInfo)})}}}:new function(){var e=null;this.init=function(t,n,o){t&&(e=t)},this.callBack=function(t){e&&e(t)},this.clear=function(){e=null},this.apiCall=function(e,t,n,o,i,r,s){var u=Fe(e,t,0,i);if(0!=u){var a=ee++,c="jsonpRequest"+a,l=document.createElement("script"),p=0;window[c]=ne,l.type="text/javascript",u=u+"&jsonpcallback="+c+"&jsonpbody="+encodeURIComponent(JSON.stringify(n)),l.src=u,l.async=!0,void 0!==l.onreadystatechange&&(l.event="onclick",l.htmlFor=l.id="_jsonpRequest_"+a),l.onload=l.onreadystatechange=function(){if(this.readyState&&"complete"!==this.readyState&&"loaded"!==this.readyState||p)return!1;l.onload=l.onreadystatechange=null,l.onclick&&l.onclick();var r=te,s="\n request url: \n"+u+"\n request body: \n"+JSON.stringify(n)+"\n response: \n"+JSON.stringify(r);r.ActionStatus==A.OK?(Me.info("["+e+"]["+t+"]success: "+s),o&&o(r)):(r.ErrorInfo="["+e+"]["+t+"]failed "+s,"longpolling"!=t||60008!=r.ErrorCode?Me.error(r.ErrorInfo):Me.warn("["+e+"]["+t+"]success: "+s),i&&i(r)),te=void 0,document.body.removeChild(l),p=1},document.body.appendChild(l)}}},je=function(e,t,n,o,i,r){this._impl={skey:je.skey(e,t),type:e,id:t,name:n,icon:o,unread:0,isAutoRead:!1,time:i>=0?i:0,curMaxMsgSeq:r>=0?r:0,msgs:[],isFinished:1}};je.skey=function(e,t){return e+t},je.prototype.type=function(){return this._impl.type},je.prototype.id=function(){return this._impl.id},je.prototype.name=function(){return this._impl.name},je.prototype.icon=function(){return this._impl.icon},je.prototype.unread=function(e){if(void 0===e)return this._impl.unread;this._impl.unread=e},je.prototype.isFinished=function(e){if(void 0===e)return this._impl.isFinished;this._impl.isFinished=e},je.prototype.time=function(){return this._impl.time},je.prototype.curMaxMsgSeq=function(e){if(void 0===e)return this._impl.curMaxMsgSeq;this._impl.curMaxMsgSeq=e},je.prototype.msgCount=function(){return this._impl.msgs.length},je.prototype.msg=function(e){return this._impl.msgs[e]},je.prototype.msgs=function(){return this._impl.msgs},je.prototype._impl_addMsg=function(e,t){this._impl.msgs.push(e),e.time>this._impl.time&&(this._impl.time=e.time),e.seq>this._impl.curMaxMsgSeq&&(this._impl.curMaxMsgSeq=e.seq),e.isSend||this._impl.isAutoRead||!t||this._impl.unread++};var Xe=function(e,t){this.toAccount=e,this.lastedMsgTime=t},We=function(e,t){for(var n=parseInt(e).toString(2)+"00000000000000000000000000000000",o=parseInt(t).toString(2),i=n.split("").reverse(),r=o.split("").reverse(),s=null,u=[],a=i.length>r.length?i.length:r.length,c=0;c<a;c++)s=Number(i[c]||0)||Number(r[c]||0),u.push(s);var l=u.reverse().join(""),p={high:"0x"+parseInt(l.substr(0,l.length-32),2).toString(16),low:"0x"+parseInt(l.substr(l.length-32-1),2).toString(16)};return new Long(p.low,p.high,!0).toString()},Qe=function(e,t,n,o,i,r,s,u,a){switch(this.sess=e,this.subType=s>=0?s:0,this.fromAccount=r,this.fromAccountNick=u||r,this.fromAccountHeadurl=a||null,this.isSend=Boolean(t),this.seq=n>=0?n:Ee(),this.random=o>=0?o:Te(),this.time=i>=0?i:_e(),this.elems=[],e.type()){case T.GROUP:this.uniqueId=We(this.seq,this.random);break;case T.C2C:default:this.uniqueId=We(this.time,this.random)}};Qe.prototype.getSession=function(){return this.sess},Qe.prototype.getType=function(){return this.subType},Qe.prototype.getSubType=function(){return this.subType},Qe.prototype.getFromAccount=function(){return this.fromAccount},Qe.prototype.getFromAccountNick=function(){return this.fromAccountNick},Qe.prototype.getIsSend=function(){return this.isSend},Qe.prototype.getSeq=function(){return this.seq},Qe.prototype.getTime=function(){return this.time},Qe.prototype.getRandom=function(){return this.random},Qe.prototype.getElems=function(){return this.elems},Qe.prototype.getMsgUniqueId=function(){return this.uniqueId},Qe.prototype.addText=function(t){this.addElem(new e.Msg.Elem(C.TEXT,t))},Qe.prototype.addFace=function(t){this.addElem(new e.Msg.Elem(C.FACE,t))},Qe.prototype.addImage=function(t){this.addElem(new e.Msg.Elem(C.IMAGE,t))},Qe.prototype.addLocation=function(t){this.addElem(new e.Msg.Elem(C.LOCATION,t))},Qe.prototype.addFile=function(t){this.addElem(new e.Msg.Elem(C.FILE,t))},Qe.prototype.addCustom=function(t){this.addElem(new e.Msg.Elem(C.CUSTOM,t))},Qe.prototype.addElem=function(e){this.elems.push(e)},Qe.prototype.toHtml=function(){var e="";for(var t in this.elems){e+=this.elems[t].toHtml()}return e},Qe.prototype.setOfflinePushInfo=function(e){this.offlinePushInfo=e},(Qe.Elem=function(e,t){this.type=e,this.content=t}).prototype.getType=function(){return this.type},Qe.Elem.prototype.getContent=function(){return this.content},Qe.Elem.prototype.toHtml=function(){return this.content.toHtml()},Qe.Elem.Text=function(e){this.text=ye.xssFilter(e)},Qe.Elem.Text.prototype.getText=function(){return this.text},Qe.Elem.Text.prototype.toHtml=function(){return this.text},Qe.Elem.Face=function(e,t){this.index=e,this.data=t},Qe.Elem.Face.prototype.getIndex=function(){return this.index},Qe.Elem.Face.prototype.getData=function(){return this.data},Qe.Elem.Face.prototype.toHtml=function(){var e=null,t=he[this.data],n=Ie[t];return n&&n[1]&&(e=n[1]),e?"<img src='"+e+"'/>":this.data},Qe.Elem.Location=function(e,t,n){this.latitude=t,this.longitude=e,this.desc=n},Qe.Elem.Location.prototype.getLatitude=function(){return this.latitude},Qe.Elem.Location.prototype.getLongitude=function(){return this.longitude},Qe.Elem.Location.prototype.getDesc=function(){return this.desc},Qe.Elem.Location.prototype.toHtml=function(){return"经度="+this.longitude+",纬度="+this.latitude+",描述="+this.desc},Qe.Elem.Images=function(e,t){this.UUID=e,"number"!=typeof t&&(t=parseInt(S[t]||S.UNKNOWN,10)),this.ImageFormat=t,this.ImageInfoArray=[]},Qe.Elem.Images.prototype.addImage=function(e){this.ImageInfoArray.push(e)},Qe.Elem.Images.prototype.toHtml=function(){var e=this.getImage(v.SMALL),t=this.getImage(v.LARGE),n=this.getImage(v.ORIGIN);return t||(t=e),n||(n=e),"<img src='"+e.getUrl()+"#"+t.getUrl()+"#"+n.getUrl()+"' style='CURSOR: hand' id='"+this.getImageId()+"' bigImgUrl='"+t.getUrl()+"' onclick='imageClick(this)' />"},Qe.Elem.Images.prototype.getImageId=function(){return this.UUID},Qe.Elem.Images.prototype.getImageFormat=function(){return this.ImageFormat},Qe.Elem.Images.prototype.getImage=function(e){for(var t in this.ImageInfoArray)if(this.ImageInfoArray[t].getType()==e)return this.ImageInfoArray[t];var n=null;return this.ImageInfoArray.forEach(function(t){t.getType()==e&&(n=t)}),n},Qe.Elem.Images.Image=function(e,t,n,o,i){this.type=e,this.size=t,this.width=n,this.height=o,this.url=i},Qe.Elem.Images.Image.prototype.getType=function(){return this.type},Qe.Elem.Images.Image.prototype.getSize=function(){return this.size},Qe.Elem.Images.Image.prototype.getWidth=function(){return this.width},Qe.Elem.Images.Image.prototype.getHeight=function(){return this.height},Qe.Elem.Images.Image.prototype.getUrl=function(){return this.url},Qe.Elem.Sound=function(e,t,n,o,i,r,s,u){this.uuid=e,this.second=t,this.size=n,this.senderId=o,this.receiverId=i,this.downFlag=r,this.busiId=s==T.C2C?2:1,2==r&&null!=u?this.downUrl=u:void 0!==this.downFlag&&void 0!==this.busiId?Ne(e,o,0,r,i,this.busiId,R.SOUND):this.downUrl=function(e,t){var n=null;return re&&ie[0]?n="https://"+N+"/asn.com/stddownload_common_file?authkey="+re+"&bid="+G+"&subbid="+se.sdkAppID+"&fileid="+e+"&filetype="+b+"&openid="+t+"&ver=0":Me.error("拼接语音下载url不报错：ip或者authkey为空"),n}(e,o)},Qe.Elem.Sound.prototype.getUUID=function(){return this.uuid},Qe.Elem.Sound.prototype.getSecond=function(){return this.second},Qe.Elem.Sound.prototype.getSize=function(){return this.size},Qe.Elem.Sound.prototype.getSenderId=function(){return this.senderId},Qe.Elem.Sound.prototype.getDownUrl=function(){return this.downUrl},Qe.Elem.Sound.prototype.toHtml=function(){return"ie"==u.type&&parseInt(u.ver)<=8?"[这是一条语音消息]demo暂不支持ie8(含)以下浏览器播放语音,语音URL:"+this.downUrl:'<audio id="uuid_'+this.uuid+'" src="'+this.downUrl+'" controls="controls" onplay="onChangePlayAudio(this)" preload="none"></audio>'},Qe.Elem.File=function(e,t,n,o,i,r,s,u){this.uuid=e,this.name=t,this.size=n,this.senderId=o,this.receiverId=i,this.downFlag=r,this.busiId=s==T.C2C?2:1,2==r&&null!=u?this.downUrl=u:void 0!==r&&void 0!==busiId?Ne(e,o,0,r,i,this.busiId,R.FILE):this.downUrl=Ge(e,o,t)},Qe.Elem.File.prototype.getUUID=function(){return this.uuid},Qe.Elem.File.prototype.getName=function(){return this.name},Qe.Elem.File.prototype.getSize=function(){return this.size},Qe.Elem.File.prototype.getSenderId=function(){return this.senderId},Qe.Elem.File.prototype.getDownUrl=function(){return this.downUrl},Qe.Elem.File.prototype.getDownFlag=function(){return this.downFlag},Qe.Elem.File.prototype.toHtml=function(){var e,t;return e=this.size,t="Byte",this.size>=1024&&(e=Math.round(this.size/1024),t="KB"),'<a href="javascript" onclick="webim.onDownFile("'+this.uuid+'")" title="点击下载文件" ><i class="glyphicon glyphicon-file">&nbsp;'+this.name+"("+e+t+")</i></a>"},Qe.Elem.GroupTip=function(e,t,n,o,i,r){this.opType=e,this.opUserId=t,this.groupId=n,this.groupName=o,this.userIdList=i||[],this.groupInfoList=[],this.memberInfoList=[],this.groupMemberNum=null,this.userinfo=r||[]},Qe.Elem.GroupTip.prototype.addGroupInfo=function(e){this.groupInfoList.push(e)},Qe.Elem.GroupTip.prototype.addMemberInfo=function(e){this.memberInfoList.push(e)},Qe.Elem.GroupTip.prototype.getOpType=function(){return this.opType},Qe.Elem.GroupTip.prototype.getOpUserId=function(){return this.opUserId},Qe.Elem.GroupTip.prototype.getGroupId=function(){return this.groupId},Qe.Elem.GroupTip.prototype.getGroupName=function(){return this.groupName},Qe.Elem.GroupTip.prototype.getUserIdList=function(){return this.userIdList},Qe.Elem.GroupTip.prototype.getUserInfo=function(){return this.userinfo},Qe.Elem.GroupTip.prototype.getGroupInfoList=function(){return this.groupInfoList},Qe.Elem.GroupTip.prototype.getMemberInfoList=function(){return this.memberInfoList},Qe.Elem.GroupTip.prototype.getGroupMemberNum=function(){return this.groupMemberNum},Qe.Elem.GroupTip.prototype.setGroupMemberNum=function(e){return this.groupMemberNum=e},Qe.Elem.GroupTip.prototype.toHtml=function(){var e="[群提示消息]";switch(this.opType){case B.JOIN:for(var t in e+=this.opUserId+"邀请了",this.userIdList)if(e+=this.userIdList[t]+",",this.userIdList.length>10&&9==t){e+="等"+this.userIdList.length+"人";break}e+="加入该群";break;case B.QUIT:e+=this.opUserId+"主动退出该群";break;case B.KICK:for(var t in e+=this.opUserId+"将",this.userIdList)if(e+=this.userIdList[t]+",",this.userIdList.length>10&&9==t){e+="等"+this.userIdList.length+"人";break}e+="踢出该群";break;case B.SET_ADMIN:for(var t in e+=this.opUserId+"将",this.userIdList)if(e+=this.userIdList[t]+",",this.userIdList.length>10&&9==t){e+="等"+this.userIdList.length+"人";break}e+="设为管理员";break;case B.CANCEL_ADMIN:for(var t in e+=this.opUserId+"取消",this.userIdList)if(e+=this.userIdList[t]+",",this.userIdList.length>10&&9==t){e+="等"+this.userIdList.length+"人";break}e+="的管理员资格";break;case B.MODIFY_GROUP_INFO:for(var t in e+=this.opUserId+"修改了群资料：",this.groupInfoList){var n=this.groupInfoList[t].getType(),o=this.groupInfoList[t].getValue();switch(n){case K.FACE_URL:e+="群头像为"+o+"; ";break;case K.NAME:e+="群名称为"+o+"; ";break;case K.OWNER:e+="群主为"+o+"; ";break;case K.NOTIFICATION:e+="群公告为"+o+"; ";break;case K.INTRODUCTION:e+="群简介为"+o+"; ";break;default:e+="未知信息为:type="+n+",value="+o+"; "}}break;case B.MODIFY_MEMBER_INFO:for(var t in e+=this.opUserId+"修改了群成员资料:",this.memberInfoList){var i=this.memberInfoList[t].getUserId(),r=this.memberInfoList[t].getShutupTime();if(e+=i+": ",e+=null!=r&&void 0!==r?0==r?"取消禁言; ":"禁言"+r+"秒; ":" shutupTime为空",this.memberInfoList.length>10&&9==t){e+="等"+this.memberInfoList.length+"人";break}}break;case B.READED:Log.info("消息已读同步");break;default:e+="未知群提示消息类型：type="+this.opType}return e},Qe.Elem.GroupTip.GroupInfo=function(e,t){this.type=e,this.value=t},Qe.Elem.GroupTip.GroupInfo.prototype.getType=function(){return this.type},Qe.Elem.GroupTip.GroupInfo.prototype.getValue=function(){return this.value},Qe.Elem.GroupTip.MemberInfo=function(e,t){this.userId=e,this.shutupTime=t},Qe.Elem.GroupTip.MemberInfo.prototype.getUserId=function(){return this.userId},Qe.Elem.GroupTip.MemberInfo.prototype.getShutupTime=function(){return this.shutupTime},Qe.Elem.Custom=function(e,t,n){this.data=e,this.desc=t,this.ext=n},Qe.Elem.Custom.prototype.getData=function(){return this.data},Qe.Elem.Custom.prototype.getDesc=function(){return this.desc},Qe.Elem.Custom.prototype.getExt=function(){return this.ext},Qe.Elem.Custom.prototype.toHtml=function(){return this.data};var Ze=new function(){var e={},t=[];i={},this.cookie="",this.syncFlag=0;var n=function(t){for(var n in e)t(e[n])};this.sessMap=function(){return e},this.sessCount=function(){return t.length},this.sessByTypeId=function(t,n){var o=je.skey(t,n);return void 0===o||null==o?null:e[o]},this.delSessByTypeId=function(t,n){var o=je.skey(t,n);return void 0!==o&&null!=o&&(e[o]&&(delete e[o],delete i[o]),!0)},this.resetCookieAndSyncFlag=function(){this.cookie="",this.syncFlag=0},this.setAutoRead=function(e,t,o){if(o&&n(function(e){e._impl.isAutoRead=!1}),e&&(e._impl.isAutoRead=t,t))if(e._impl.unread=0,e._impl.type==T.C2C){var i=[];i.push(new Xe(e._impl.id,e._impl.time)),ke(Ze.cookie,i,function(e){Me.info("[setAutoRead]: c2CMsgReaded success")},function(e){Me.error("[setAutoRead}: c2CMsgReaded failed:"+e.ErrorInfo)})}else if(e._impl.type==T.GROUP){var r={GroupId:e._impl.id,MsgReadedSeq:e._impl.curMaxMsgSeq};xe(r,function(e){Me.info("groupMsgReaded success")},function(e){Me.error("groupMsgReaded failed:"+e.ErrorInfo)})}},this.c2CMsgReaded=function(e,t,n){var o=[];o.push(new Xe(e.To_Account,e.LastedMsgTime)),ke(Ze.cookie,o,function(e){t&&(Me.info("c2CMsgReaded success"),t(e))},function(e){n&&(Me.error("c2CMsgReaded failed:"+e.ErrorInfo),n(e))})},this.addSession=function(t){e[t._impl.skey]=t},this.delSession=function(t){delete e[t._impl.skey]},this.clear=function(){e={},t=[],i={},this.cookie="",this.syncFlag=0},this.addMsg=function(t,n){if(function(e){var t=!1,n=e.sess._impl.skey,o=e.isSend+e.seq+e.random;return i[n]&&i[n][o]&&(t=!0),i[n]?i[n][o]={time:e.time}:(i[n]={},i[n][o]={time:e.time}),t}(t))return!1;var o=t.sess;return e[o._impl.skey]||this.addSession(o),o._impl_addMsg(t,n),!0},this.updateTimeline=function(){var e=new Array;n(function(t){e.push(t)}),e.sort(function(e,t){return t.time-e.time}),t=e}},$e=new function(){var e=null,t=null,n={1:null,2:null,3:null,4:null,5:null,6:null,7:null,8:null,9:null,10:null,11:null,15:null,255:null,12:null},o={1:null,2:null,3:null,4:null,5:null,6:null,7:null,8:null},i={1:null},r=null,s=!1,u=0,a=0,p=null,f=!1,g={},d=90,m=null,I={},y={92:null,96:null},M={},_={};this.setLongPollingOn=function(e){s=e},this.getLongPollingOn=function(){return s},this.resetLongPollingInfo=function(){s=!1,u=0,a=0},this.setBigGroupLongPollingOn=function(e){f=e},this.checkBigGroupLongPollingOn=function(e){return!!m[e]},this.setBigGroupLongPollingKey=function(e,t){m[e]=t},this.resetBigGroupLongPollingInfo=function(e){f=!1,g[e]=0,m[e]=null,I[e]={},g[e].delete(),m[e].delete(),I[e].delete()},this.setBigGroupLongPollingMsgMap=function(e,t){var n=I[e];n?(n=parseInt(n)+t,I[e]=n):I[e]=t},this.clear=function(){t=null,n={1:null,2:null,3:null,4:null,5:null,6:null,7:null,8:null,9:null,10:null,11:null,15:null,255:null,12:null},o={1:null,2:null,3:null,4:null,5:null,6:null,7:null,8:null},i={1:null},e=null,s=!1,u=0,a=0,p=null,f=!1,g={},m={},I={},_={},ie=[],re=null,null};var E=function(e,t){!function(e,t){ve(t,!0)&&Ye.apiCall(c,"authkey",{},e,t)}(function(t){ie=t.IpList,re=t.AuthKey,t.ExpireTime,e&&e(t)},function(e){Me.error("initIpAndAuthkey failed:"+e.ErrorInfo),t&&t(e)})},v=function(e,t){for(var n in e){var o=e[n];if(o.From_Account){var i=te(o,!1,!0);i&&t.push(i),r=o.ToGroupId,s=o.MsgSeq,u=void 0,(u=M[r])?s>u&&(M[r]=s):M[r]=s}}var r,s,u;return t},S=function(t,n){var o={},i=[];for(var r in n){var s=o[n[r].ToGroupId];s||(s=o[n[r].ToGroupId]={min:99999999,max:-1,msgs:[]}),n[r].NoticeSeq>a&&(Me.warn("noticeSeq="+a+",msgNoticeSeq="+n[r].NoticeSeq),a=n[r].NoticeSeq),n[r].Event=t,o[n[r].ToGroupId].msgs.push(n[r]),n[r].MsgSeq<s.min&&(o[n[r].ToGroupId].min=n[r].MsgSeq),n[r].MsgSeq>s.max&&(o[n[r].ToGroupId].max=n[r].MsgSeq)}for(var u in o)i=v(o[u].msgs,i);i.length&&Ze.updateTimeline(),e&&i.length&&e(i)},F=function(t,n){var o={},i=[];for(var r in n){var s=o[n[r].ToGroupId];s||(s=o[n[r].ToGroupId]={min:99999999,max:-1,msgs:[]}),n[r].NoticeSeq>a&&(Me.warn("noticeSeq="+a+",msgNoticeSeq="+n[r].NoticeSeq),a=n[r].NoticeSeq),n[r].Event=t,o[n[r].ToGroupId].msgs.push(n[r]),n[r].MsgSeq<s.min&&(o[n[r].ToGroupId].min=n[r].MsgSeq),n[r].MsgSeq>s.max&&(o[n[r].ToGroupId].max=n[r].MsgSeq)}for(var u in o)i=v(o[u].msgs,i);i.length&&Ze.updateTimeline(),e&&i.length&&e(i)},G=function(e,t){for(var o in e){var i=e[o],r=i.MsgBody,s=r.ReportType;0==t&&i.NoticeSeq&&i.NoticeSeq>a&&(a=i.NoticeSeq);i.GroupInfo.To_Account;if(t){var u=i.ToGroupId+"_"+s+"_"+r.Operator_Account;if(_[u]){Me.warn("收到重复的群系统消息：key="+u);continue}_[u]=!0}var c={SrcFlag:0,ReportType:s,GroupId:i.ToGroupId,GroupName:i.GroupInfo.GroupName,Operator_Account:r.Operator_Account,MsgTime:i.MsgTimeStamp,groupReportTypeMsg:r};switch(s){case H.JOIN_GROUP_REQUEST:c.RemarkInfo=r.RemarkInfo,c.MsgKey=r.MsgKey,c.Authentication=r.Authentication,c.UserDefinedField=i.UserDefinedField,c.From_Account=i.From_Account,c.MsgSeq=i.ClientSeq,c.MsgRandom=i.MsgRandom;break;case H.JOIN_GROUP_ACCEPT:case H.JOIN_GROUP_REFUSE:c.RemarkInfo=r.RemarkInfo;break;case H.KICK:case H.DESTORY:case H.CREATE:case H.INVITED_JOIN_GROUP_REQUEST:case H.INVITED_JOIN_GROUP_REQUEST_AGREE:case H.QUIT:case H.SET_ADMIN:case H.CANCEL_ADMIN:case H.REVOKE:case H.READED:break;case H.CUSTOM:c.MsgSeq=i.MsgSeq,c.UserDefinedField=r.UserDefinedField;break;default:Me.error("未知群系统消息类型：reportType="+s)}if(t)n[s]?n[s](c):Me.error("未知群系统消息类型：reportType="+s);else if(n[s])if(s==H.READED)for(var l=c.groupReportTypeMsg.GroupReadInfoArray,p=0,f=l.length;p<f;p++){var g=l[p];n[s](g)}else n[s](c)}},N=function(e,t){var n,i,r;for(var s in e){switch(i=(n=e[s]).PushType,0==t&&n.NoticeSeq&&n.NoticeSeq>a&&(a=n.NoticeSeq),r={Type:i},i){case J.FRIEND_ADD:r.Accounts=n.FriendAdd_Account;break;case J.FRIEND_DELETE:r.Accounts=n.FriendDel_Account;break;case J.PENDENCY_ADD:r.PendencyList=n.PendencyAdd;break;case J.PENDENCY_DELETE:r.Accounts=n.FrienPencydDel_Account;break;case J.BLACK_LIST_ADD:r.Accounts=n.BlackListAdd_Account;break;case J.BLACK_LIST_DELETE:r.Accounts=n.BlackListDel_Account;break;default:Me.error("未知好友系统通知类型：friendNotice="+JSON.stringify(n))}t?i==J.PENDENCY_ADD&&o[i]&&o[i](r):o[i]&&o[i](r)}},b=function(e,t){var n,o,r;for(var s in e){switch(o=(n=e[s]).PushType,0==t&&n.NoticeSeq&&n.NoticeSeq>a&&(a=n.NoticeSeq),r={Type:o},o){case V:r.Profile_Account=n.Profile_Account,r.ProfileList=n.ProfileList;break;default:Me.error("未知资料系统通知类型：profileNotice="+JSON.stringify(n))}t?o==V&&i[o]&&i[o](r):i[o]&&i[o](r)}},O=function(e){var t=e.MsgBody,o=t.ReportType,i=(e.GroupInfo.To_Account,{SrcFlag:1,ReportType:o,GroupId:e.ToGroupId,GroupName:e.GroupInfo.GroupName,Operator_Account:t.Operator_Account,MsgTime:e.MsgTimeStamp});switch(o){case H.JOIN_GROUP_REQUEST:i.RemarkInfo=t.RemarkInfo,i.MsgKey=t.MsgKey,i.Authentication=t.Authentication,i.UserDefinedField=e.UserDefinedField,i.From_Account=e.From_Account,i.MsgSeq=e.ClientSeq,i.MsgRandom=e.MsgRandom;break;case H.JOIN_GROUP_ACCEPT:case H.JOIN_GROUP_REFUSE:i.RemarkInfo=t.RemarkInfo;break;case H.KICK:case H.DESTORY:case H.CREATE:case H.INVITED_JOIN_GROUP_REQUEST:case H.INVITED_JOIN_GROUP_REQUEST_AGREE:case H.QUIT:case H.SET_ADMIN:case H.CANCEL_ADMIN:case H.REVOKE:break;case H.CUSTOM:i.MsgSeq=e.MsgSeq,i.UserDefinedField=t.UserDefinedField;break;default:Me.error("未知群系统消息类型：reportType="+o)}n[o]&&n[o](i)},R=function(e){for(var t=0,n=e.length;t<n;t++)w(e[t])},w=function(e){var t=e.SubMsgType;switch(t){case U:if(Me.warn("C2C已读消息通知"),e.ReadC2cMsgNotify&&e.ReadC2cMsgNotify.UinPairReadArray&&y[t])for(var n=0,o=e.ReadC2cMsgNotify.UinPairReadArray.length;n<o;n++){var i=e.ReadC2cMsgNotify.UinPairReadArray[n];y[t](i)}break;case k:Me.warn("多终端互踢通知"),Le("instance"),y[t]&&y[t]();break;default:Me.error("未知C2c系统消息：subType="+t)}};this.longPolling=function(e,t){var n={Timeout:Q/1e3,Cookie:{NotifySeq:u,NoticeSeq:a}};function o(){Pe(n,function(e){for(var t in e.EventArray){var n=e.EventArray[t];switch(n.Event){case L.C2C:u=n.NotifySeq,Me.warn("longpolling: received new c2c msg"),$e.syncMsgs();break;case L.GROUP_COMMON:Me.warn("longpolling: received new group msgs"),F(n.Event,n.GroupMsgArray);break;case L.GROUP_TIP:case L.GROUP_TIP2:Me.warn("longpolling: received new group tips"),F(n.Event,n.GroupTips);break;case L.GROUP_SYSTEM:Me.warn("longpolling: received new group system msgs"),G(n.GroupTips,!1);break;case L.FRIEND_NOTICE:Me.warn("longpolling: received new friend system notice"),N(n.FriendListMod,!1);break;case L.PROFILE_NOTICE:Me.warn("longpolling: received new profile system notice"),b(n.ProfileDataMod,!1);break;case L.C2C_COMMON:a=n.C2cMsgArray[0].NoticeSeq,Me.warn("longpolling: received new c2c_common msg",a),S(n.Event,n.C2cMsgArray);break;case L.C2C_EVENT:a=n.C2cNotifyMsgArray[0].NoticeSeq,Me.warn("longpolling: received new c2c_event msg"),R(n.C2cNotifyMsgArray);break;default:Me.error("longpolling收到未知新消息类型: Event="+n.Event)}}var o={ActionStatus:A.OK,ErrorCode:0};$(o)},function(e){$(e),t&&t(e)})}Z?(n.Cookie.LongPollingId=Z,o()):Ve(0,function(e){Z=n.Cookie.LongPollingId=e.LongPollingId,Q=e.Timeout>60?Q:1e3*e.Timeout,o()})},this.bigGroupLongPolling=function(e,t,n){!function(e,t,n,o){Ye.apiCall(h,"get_msg",e,t,n,o)}({USP:1,StartSeq:g[e],HoldTime:d,Key:m[e]},function(n){var o=[];if(g[e]=n.NextSeq,d=n.HoldTime,m[e]=n.Key,n.RspMsgList&&n.RspMsgList.length>0){for(var i,r,s,u=0,a=n.RspMsgList.length-1;a>=0;a--){i=n.RspMsgList[a];if(!(i=ye.replaceObject({F_Account:"From_Account",T_Account:"To_Account",FAType:"EnumFrom_AccountType",TAType:"EnumTo_AccountType",GCode:"GroupCode",GName:"GroupName",GId:"GroupId",MFlg:"MsgFlag",FAEInfo:"MsgFrom_AccountExtraInfo",Evt:"Event",GInfo:"GroupInfo",BPlc:"IsPlaceMsg",MBody:"MsgBody",Pri:"MsgPriority",Rdm:"MsgRandom",MSeq:"MsgSeq",TStp:"MsgTimeStamp",TGId:"ToGroupId",UEInfo:"UinExtInfo",UId:"UserId",BSys:"IsSystemMsg",FAHUrl:"From_AccountHeadurl",FANick:"From_AccountNick"},i)).IsPlaceMsg&&i.From_Account&&i.MsgBody&&0!=i.MsgBody.length)switch(r=i.Event){case L.GROUP_COMMON:Me.info("bigGroupLongPolling: return new group msg"),(s=te(i,!1,!1))&&o.push(s),u+=1;break;case L.GROUP_TIP:case L.GROUP_TIP2:Me.info("bigGroupLongPolling: return new group tip"),(s=te(i,!1,!1))&&o.push(s);break;case L.GROUP_SYSTEM:Me.info("bigGroupLongPolling: new group system msg"),O(i);break;default:Me.error("bigGroupLongPolling收到未知新消息类型: Event="+r)}}u>0&&($e.setBigGroupLongPollingMsgMap(i.ToGroupId,u),Me.warn("current bigGroupLongPollingMsgMap: "+JSON.stringify(I)))}0;var c={ActionStatus:A.OK,ErrorCode:z.ON,ErrorInfo:"connection is ok..."};Ye.callBack(c),t?t(o):p&&p(o),f&&$e.bigGroupLongPolling(e)},function(t){10018==t.ErrorCode?g[e]=0:60008!=t.ErrorCode&&(Me.error(t.ErrorInfo),0),91101==t.ErrorCode&&(Me.error("多实例登录，被kick"),r&&r()),f&&$e.bigGroupLongPolling(e),n&&n(t)},1e3*d)};var $=function(e){if(0==e.ErrorCode||60008==e.ErrorCode){var t;W=0,X=!1;var n=!1;switch(j){case z.INIT:n=!0,j=z.ON,t="create connection successfully(INIT->ON)";break;case z.ON:t="connection is on...(ON->ON)";break;case z.RECONNECT:j=z.ON,t="connection is on...(RECONNECT->ON)";break;case z.OFF:n=!0,j=z.RECONNECT,t="reconnect successfully(OFF->RECONNECT)"}var o={ActionStatus:A.OK,ErrorCode:j,ErrorInfo:t};n&&Ye.callBack(o),s&&$e.longPolling()}else if(91101==e.ErrorCode)Me.error("多实例登录，被kick"),r&&r();else if(W++,Me.warn("longPolling接口第"+W+"次报错: "+e.ErrorInfo),W<=10)setTimeout(ee,100);else{j=z.OFF;var i={ActionStatus:A.FAIL,ErrorCode:z.OFF,ErrorInfo:"connection is off"};0==X&&Ye.callBack(i),X=!0,Me.warn("5000毫秒之后,SDK会发起新的longPolling请求..."),setTimeout(ee,5e3)}},ee=(S=function(t,n){var o,i=[];for(var r in o=n){var s,u,a=o[r],c=a.From_AccountHeadurl||"";a.From_Account==se.identifier?(s=!0,u=a.To_Account):(s=!1,u=a.From_Account);var l=Ze.sessByTypeId(T.C2C,u);l||(l=new je(T.C2C,u,u,c,0,0));var p=new Qe(l,s,a.MsgSeq,a.MsgRandom,a.MsgTimeStamp,a.From_Account,P.COMMON,a.From_AccountNick,c),f=null,g=null,d=null;for(var m in a.MsgBody){switch(d=(f=a.MsgBody[m]).MsgType){case C.TEXT:g=new Qe.Elem.Text(f.MsgContent.Text);break;case C.FACE:g=new Qe.Elem.Face(f.MsgContent.Index,f.MsgContent.Data);break;case C.IMAGE:for(var h in g=new Qe.Elem.Images(f.MsgContent.UUID,f.MsgContent.ImageFormat||""),f.MsgContent.ImageInfoArray){var I=f.MsgContent.ImageInfoArray[h];g.addImage(new Qe.Elem.Images.Image(I.Type,I.Size,I.Width,I.Height,I.URL))}break;case C.SOUND:f.MsgContent?g=new Qe.Elem.Sound(f.MsgContent.UUID,f.MsgContent.Second,f.MsgContent.Size,a.From_Account,a.To_Account,f.MsgContent.Download_Flag,T.C2C,f.MsgContent.Url||null):(d=C.TEXT,g=new Qe.Elem.Text("[语音消息]下载地址解析出错"));break;case C.LOCATION:g=new Qe.Elem.Location(f.MsgContent.Longitude,f.MsgContent.Latitude,f.MsgContent.Desc);break;case C.FILE:case C.FILE+" ":d=C.FILE,f.MsgContent?g=new Qe.Elem.File(f.MsgContent.UUID,f.MsgContent.FileName,f.MsgContent.FileSize,a.From_Account,a.To_Account,f.MsgContent.Download_Flag,T.C2C,f.MsgContent.Url||null):(d=C.TEXT,g=new Qe.Elem.Text("[文件消息下载地址解析出错]"));break;case C.CUSTOM:try{var y=JSON.parse(f.MsgContent.Data);if(y&&y.userAction&&y.userAction==Y)continue}catch(e){}d=C.CUSTOM,g=new Qe.Elem.Custom(f.MsgContent.Data,f.MsgContent.Desc,f.MsgContent.Ext);break;default:d=C.TEXT,g=new Qe.Elem.Text("web端暂不支持"+f.MsgType+"消息")}p.elems.push(new Qe.Elem(d,g))}p.elems.length>0&&Ze.addMsg(p,!0)&&i.push(p)}i.length>0&&Ze.updateTimeline(),i.length>0&&e&&e(i)},function(){s&&$e.longPolling()});this.syncMsgs=function(t,n){var o=[],i=[];Ue(Ze.cookie,Ze.syncFlag,function(n){for(var r in 2==n.SyncFlag&&(Ze.syncFlag=0),i=n.MsgList,Ze.cookie=n.Cookie,i){var s,u,a,c=i[r];c.From_Account==se.identifier?(s=!0,u=c.To_Account,a=""):(s=!1,u=c.From_Account,a="");var l=Ze.sessByTypeId(T.C2C,u);l||(l=new je(T.C2C,u,u,a,0,0));var p=new Qe(l,s,c.MsgSeq,c.MsgRandom,c.MsgTimeStamp,c.From_Account,P.COMMON,c.From_AccountNick,c.From_AccountHeadurl),f=null,g=null,d=null;for(var m in c.MsgBody){switch(d=(f=c.MsgBody[m]).MsgType){case C.TEXT:g=new Qe.Elem.Text(f.MsgContent.Text);break;case C.FACE:g=new Qe.Elem.Face(f.MsgContent.Index,f.MsgContent.Data);break;case C.IMAGE:for(var h in g=new Qe.Elem.Images(f.MsgContent.UUID,f.MsgContent.ImageFormat),f.MsgContent.ImageInfoArray){var I=f.MsgContent.ImageInfoArray[h];g.addImage(new Qe.Elem.Images.Image(I.Type,I.Size,I.Width,I.Height,I.URL))}break;case C.SOUND:f.MsgContent?g=new Qe.Elem.Sound(f.MsgContent.UUID,f.MsgContent.Second,f.MsgContent.Size,c.From_Account,c.To_Account,f.MsgContent.Download_Flag,T.C2C,f.MsgContent.Url||null):(d=C.TEXT,g=new Qe.Elem.Text("[语音消息]下载地址解析出错"));break;case C.LOCATION:g=new Qe.Elem.Location(f.MsgContent.Longitude,f.MsgContent.Latitude,f.MsgContent.Desc);break;case C.FILE:case C.FILE+" ":d=C.FILE,f.MsgContent?g=new Qe.Elem.File(f.MsgContent.UUID,f.MsgContent.FileName,f.MsgContent.FileSize,c.From_Account,c.To_Account,f.MsgContent.Download_Flag,T.C2C,f.MsgContent.Url||null):(d=C.TEXT,g=new Qe.Elem.Text("[文件消息下载地址解析出错]"));break;case C.CUSTOM:try{var y=JSON.parse(f.MsgContent.Data);if(y&&y.userAction&&y.userAction==Y)continue}catch(e){}d=C.CUSTOM,g=new Qe.Elem.Custom(f.MsgContent.Data,f.MsgContent.Desc,f.MsgContent.Ext);break;default:d=C.TEXT,g=new Qe.Elem.Text("web端暂不支持"+f.MsgType+"消息")}p.elems.push(new Qe.Elem(d,g))}p.elems.length>0&&Ze.addMsg(p,!0)&&o.push(p)}!function(e){for(var t in e){var n=e[t];switch(G(n.GroupTips,!0),n.Event){case L.GROUP_SYSTEM:Me.warn("handlerApplyJoinGroupSystemMsgs： handler new group system msg"),G(n.GroupTips,!0);break;default:Me.error("syncMsgs收到未知的群系统消息类型: Event="+n.Event)}}}(n.EventArray),o.length>0&&Ze.updateTimeline(),t?t(o):o.length>0&&e&&e(o)},function(e){Me.error("getMsgs failed:"+e.ErrorInfo),n&&n(e)})},this.getC2CHistoryMsgs=function(e,t,n){if(e.Peer_Account||!n)if(e.MaxCnt||(e.MaxCnt=15),e.MaxCnt<=0&&n)n(ye.getReturnError("MaxCnt should be greater than 0",-14));else{if(e.MaxCnt>15)return n?void n(ye.getReturnError("MaxCnt can not be greater than 15",-15)):void 0;null!=e.MsgKey&&void 0!==e.MsgKey||(e.MsgKey="");var o={Peer_Account:e.Peer_Account,MaxCnt:e.MaxCnt,LastMsgTime:e.LastMsgTime,MsgKey:e.MsgKey};De(o,function(n){var o,i=[];o=n.MsgList;var r=Ze.sessByTypeId(T.C2C,e.Peer_Account);for(var s in r||(r=new je(T.C2C,e.Peer_Account,e.Peer_Account,"",0,0)),o){var u,a=o[s],c=a.From_AccountHeadurl||"";a.From_Account==se.identifier?(u=!0,a.To_Account):(u=!1,a.From_Account);var l=new Qe(r,u,a.MsgSeq,a.MsgRandom,a.MsgTimeStamp,a.From_Account,P.COMMON,a.From_AccountNick,c),p=null,f=null,g=null;for(var d in a.MsgBody){switch(g=(p=a.MsgBody[d]).MsgType){case C.TEXT:f=new Qe.Elem.Text(p.MsgContent.Text);break;case C.FACE:f=new Qe.Elem.Face(p.MsgContent.Index,p.MsgContent.Data);break;case C.IMAGE:for(var m in f=new Qe.Elem.Images(p.MsgContent.UUID,p.MsgContent.ImageFormat),p.MsgContent.ImageInfoArray){var h=p.MsgContent.ImageInfoArray[m];f.addImage(new Qe.Elem.Images.Image(h.Type,h.Size,h.Width,h.Height,h.URL))}break;case C.SOUND:p.MsgContent?f=new Qe.Elem.Sound(p.MsgContent.UUID,p.MsgContent.Second,p.MsgContent.Size,a.From_Account,a.To_Account,p.MsgContent.Download_Flag,T.C2C,p.MsgContent.Url||null):(g=C.TEXT,f=new Qe.Elem.Text("[语音消息]下载地址解析出错"));break;case C.LOCATION:f=new Qe.Elem.Location(p.MsgContent.Longitude,p.MsgContent.Latitude,p.MsgContent.Desc);break;case C.FILE:case C.FILE+" ":g=C.FILE,p.MsgContent?f=new Qe.Elem.File(p.MsgContent.UUID,p.MsgContent.FileName,p.MsgContent.FileSize,a.From_Account,a.To_Account,p.MsgContent.Download_Flag,T.C2C,p.MsgContent.Url||null):(g=C.TEXT,f=new Qe.Elem.Text("[文件消息下载地址解析出错]"));break;case C.CUSTOM:g=C.CUSTOM,f=new Qe.Elem.Custom(p.MsgContent.Data,p.MsgContent.Desc,p.MsgContent.Ext);break;default:g=C.TEXT,f=new Qe.Elem.Text("web端暂不支持"+p.MsgType+"消息")}l.elems.push(new Qe.Elem(g,f))}Ze.addMsg(l),i.push(l)}if(Ze.updateTimeline(),t){var I={Complete:n.Complete,MsgCount:i.length,LastMsgTime:n.LastMsgTime,MsgKey:n.MsgKey,MsgList:i};r.isFinished(n.Complete),t(I)}},function(e){Me.error("getC2CHistoryMsgs failed:"+e.ErrorInfo),n&&n(e)})}else n(ye.getReturnError("Peer_Account is empty",-13))},this.syncGroupMsgs=function(t,n,o){if(t.ReqMsgSeq<=0){if(o){var i=ye.getReturnError("ReqMsgSeq must be greater than 0",-16);o(i)}}else!function(e,t,n){ve(n,!0)&&Ye.apiCall(l,"group_msg_get",{GroupId:e.GroupId,ReqMsgSeq:e.ReqMsgSeq,ReqMsgNumber:e.ReqMsgNumber},t,n)}({GroupId:t.GroupId,ReqMsgSeq:t.ReqMsgSeq,ReqMsgNumber:t.ReqMsgNumber},function(t){var o=[],i=(t.GroupId,t.RspMsgList),r=t.IsFinished;if(null!=i&&void 0!==i){for(var s=i.length-1;s>=0;s--){var u=i[s];if(!u.IsPlaceMsg&&u.From_Account&&u.MsgBody&&0!=u.MsgBody.length){var a=te(u,!0,!0,r);a&&o.push(a)}}o.length>0&&Ze.updateTimeline(),n?n(o):o.length>0&&e&&e(o)}else n&&n([])},function(e){Me.error("getGroupMsgs failed:"+e.ErrorInfo),o&&o(e)})};var te=function(e,n,o,i){if(e.IsPlaceMsg||!e.From_Account||!e.MsgBody||0==e.MsgBody.length)return null;var r,s,u,a,c=e.ToGroupId,l=c;e.GroupInfo&&e.GroupInfo.GroupName&&(l=e.GroupInfo.GroupName),u=e.From_Account,e.GroupInfo&&(e.GroupInfo.From_AccountNick&&(u=e.GroupInfo.From_AccountNick),a=e.GroupInfo.From_AccountHeadurl?e.GroupInfo.From_AccountHeadurl:null),e.From_Account==se.identifier?(r=!0,e.From_Account,s=""):(r=!1,e.From_Account,s="");var p=Ze.sessByTypeId(T.GROUP,c);p||(p=new je(T.GROUP,c,l,s,0,0)),void 0!==i&&p.isFinished(i||0);var f=D.COMMON;if(L.GROUP_TIP==e.Event||L.GROUP_TIP2==e.Event){f=D.TIP;var g=e.MsgBody;e.MsgBody=[],e.MsgBody.push({MsgType:C.GROUP_TIP,MsgContent:g})}else e.MsgPriority&&(e.MsgPriority==q?f=D.REDPACKET:e.MsgPriority==x&&(f=D.LOVEMSG));var d=new Qe(p,r,e.MsgSeq,e.MsgRandom,e.MsgTimeStamp,e.From_Account,f,u,a),m=null,h=null,I=null;for(var y in e.MsgBody){switch(I=(m=e.MsgBody[y]).MsgType){case C.TEXT:h=new Qe.Elem.Text(m.MsgContent.Text);break;case C.FACE:h=new Qe.Elem.Face(m.MsgContent.Index,m.MsgContent.Data);break;case C.IMAGE:for(var M in h=new Qe.Elem.Images(m.MsgContent.UUID,m.MsgContent.ImageFormat||""),m.MsgContent.ImageInfoArray)h.addImage(new Qe.Elem.Images.Image(m.MsgContent.ImageInfoArray[M].Type,m.MsgContent.ImageInfoArray[M].Size,m.MsgContent.ImageInfoArray[M].Width,m.MsgContent.ImageInfoArray[M].Height,m.MsgContent.ImageInfoArray[M].URL));break;case C.SOUND:m.MsgContent?h=new Qe.Elem.Sound(m.MsgContent.UUID,m.MsgContent.Second,m.MsgContent.Size,e.From_Account,e.To_Account,m.MsgContent.Download_Flag,T.GROUP,m.MsgContent.Url||null):(I=C.TEXT,h=new Qe.Elem.Text("[语音消息]下载地址解析出错"));break;case C.LOCATION:h=new Qe.Elem.Location(m.MsgContent.Longitude,m.MsgContent.Latitude,m.MsgContent.Desc);break;case C.FILE:case C.FILE+" ":I=C.FILE;Ge(m.MsgContent.UUID,e.From_Account,m.MsgContent.FileName);m.MsgContent?h=new Qe.Elem.File(m.MsgContent.UUID,m.MsgContent.FileName,m.MsgContent.FileSize,e.From_Account,e.To_Account,m.MsgContent.Download_Flag,T.GROUP,m.MsgContent.Url||null):(I=C.TEXT,h=new Qe.Elem.Text("[文件消息]地址解析出错"));break;case C.GROUP_TIP:var _=m.MsgContent.OpType;if(h=new Qe.Elem.GroupTip(_,m.MsgContent.Operator_Account,c,e.GroupInfo.GroupName,m.MsgContent.List_Account,m.MsgContent.MsgMemberExtraInfo),B.JOIN==_||B.QUIT==_)h.setGroupMemberNum(m.MsgContent.MemberNum);else if(B.MODIFY_GROUP_INFO==_){var E=!1,A={GroupId:c,GroupFaceUrl:null,GroupName:null,OwnerAccount:null,GroupNotification:null,GroupIntroduction:null},v=m.MsgContent.MsgGroupNewInfo;if(v.GroupFaceUrl){var S=new Qe.Elem.GroupTip.GroupInfo(K.FACE_URL,v.GroupFaceUrl);h.addGroupInfo(S),E=!0,A.GroupFaceUrl=v.GroupFaceUrl}if(v.GroupName){var F=new Qe.Elem.GroupTip.GroupInfo(K.NAME,v.GroupName);h.addGroupInfo(F),E=!0,A.GroupName=v.GroupName}if(v.Owner_Account){var G=new Qe.Elem.GroupTip.GroupInfo(K.OWNER,v.Owner_Account);h.addGroupInfo(G),E=!0,A.OwnerAccount=v.Owner_Account}if(v.GroupNotification){var N=new Qe.Elem.GroupTip.GroupInfo(K.NOTIFICATION,v.GroupNotification);h.addGroupInfo(N),E=!0,A.GroupNotification=v.GroupNotification}if(v.GroupIntroduction){var b=new Qe.Elem.GroupTip.GroupInfo(K.INTRODUCTION,v.GroupIntroduction);h.addGroupInfo(b),E=!0,A.GroupIntroduction=v.GroupIntroduction}0==n&&E&&t&&t(A)}else if(B.MODIFY_MEMBER_INFO==_){var O=m.MsgContent.MsgMemberInfo;for(var R in O){var w=O[R];h.addMemberInfo(new Qe.Elem.GroupTip.MemberInfo(w.User_Account,w.ShutupTime))}}break;case C.CUSTOM:I=C.CUSTOM,h=new Qe.Elem.Custom(m.MsgContent.Data,m.MsgContent.Desc,m.MsgContent.Ext);break;default:I=C.TEXT,h=new Qe.Elem.Text("web端暂不支持"+m.MsgType+"消息")}d.elems.push(new Qe.Elem(I,h))}return 0==o?d:Ze.addMsg(d,!0)?(d.extraInfo=e.GroupInfo.MsgFrom_AccountExtraInfo,d):null};this.init=function(u,a,c){if(u.onMsgNotify||Me.warn("listeners.onMsgNotify is empty"),e=u.onMsgNotify,u.onBigGroupMsgNotify?p=u.onBigGroupMsgNotify:Me.warn("listeners.onBigGroupMsgNotify is empty"),u.onC2cEventNotifys?y=u.onC2cEventNotifys:Me.warn("listeners.onC2cEventNotifys is empty"),u.onGroupSystemNotifys?n=u.onGroupSystemNotifys:Me.warn("listeners.onGroupSystemNotifys is empty"),u.onGroupInfoChangeNotify?t=u.onGroupInfoChangeNotify:Me.warn("listeners.onGroupInfoChangeNotify is empty"),u.onFriendSystemNotifys?o=u.onFriendSystemNotifys:Me.warn("listeners.onFriendSystemNotifys is empty"),u.onProfileSystemNotifys?i=u.onProfileSystemNotifys:Me.warn("listeners.onProfileSystemNotifys is empty"),u.onKickedEventCall?r=u.onKickedEventCall:Me.warn("listeners.onKickedEventCall is empty"),u.onLongPullingNotify?de=u.onLongPullingNotify:Me.warn("listeners.onKickedEventCall is empty"),u.onAppliedDownloadUrl?u.onAppliedDownloadUrl:Me.warn("listeners.onAppliedDownloadUrl is empty"),se.identifier&&se.userSig)!function(e,t){var n={Member_Account:se.identifier,Limit:1e3,Offset:0,GroupBaseInfoFilter:["NextMsgSeq"]};qe(n,function(t){if(!t.GroupIdList||0==t.GroupIdList.length)return Me.info("initMyGroupMaxSeqs: 目前还没有加入任何群组"),void(e&&e(t));for(var n=0;n<t.GroupIdList.length;n++){var o=t.GroupIdList[n].GroupId,i=t.GroupIdList[n].NextMsgSeq-1;M[o]=i}e&&e(t)},function(e){Me.error("initMyGroupMaxSeqs failed:"+e.ErrorInfo),t&&t(e)})}(function(e){Me.info("initMyGroupMaxSeqs success"),E(function(e){if(Me.info("initIpAndAuthkey success"),a){Me.info("login success(have login state))");var t={ActionStatus:A.OK,ErrorCode:0,ErrorInfo:"login success"};a(t)}$e.setLongPollingOn(!0),s&&$e.longPolling(a)},c)},c);else if(a){var l={ActionStatus:A.OK,ErrorCode:0,ErrorInfo:"login success(no login state)"};a(l)}},this.sendMsg=function(e,t,n){!function(e,t,n){if(ve(n,!0)){var o=null;switch(e.sess.type()){case T.C2C:o={From_Account:se.identifier,To_Account:e.sess.id().toString(),MsgTimeStamp:e.time,MsgSeq:e.seq,MsgRandom:e.random,MsgBody:[],OfflinePushInfo:e.offlinePushInfo};break;case T.GROUP:var i=e.getSubType();switch(o={GroupId:e.sess.id().toString(),From_Account:se.identifier,Random:e.random,MsgBody:[]},i){case D.COMMON:o.MsgPriority="COMMON";break;case D.REDPACKET:o.MsgPriority="REDPACKET";break;case D.LOVEMSG:o.MsgPriority="LOVEMSG";break;case D.TIP:Me.error("不能主动发送群提示消息,subType="+i);break;default:return void Me.error("发送群消息时，出现未知子消息类型：subType="+i)}}for(var r in e.elems){var s=e.elems[r],u=null,a=s.type;switch(a){case C.TEXT:u={Text:s.content.text};break;case C.FACE:u={Index:s.content.index,Data:s.content.data};break;case C.IMAGE:var p=[];for(var f in s.content.ImageInfoArray)p.push({Type:s.content.ImageInfoArray[f].type,Size:s.content.ImageInfoArray[f].size,Width:s.content.ImageInfoArray[f].width,Height:s.content.ImageInfoArray[f].height,URL:s.content.ImageInfoArray[f].url});u={ImageFormat:s.content.ImageFormat,UUID:s.content.UUID,ImageInfoArray:p};break;case C.SOUND:Me.warn("web端暂不支持发送语音消息");continue;case C.LOCATION:Me.warn("web端暂不支持发送地理位置消息");continue;case C.FILE:u={UUID:s.content.uuid,FileName:s.content.name,FileSize:s.content.size,DownloadFlag:s.content.downFlag};break;case C.CUSTOM:u={Data:s.content.data,Desc:s.content.desc,Ext:s.content.ext},a=C.CUSTOM;break;default:Me.warn("web端暂不支持发送"+s.type+"消息");continue}e.PushInfoBoolean&&(o.OfflinePushInfo=e.PushInfo),o.MsgBody.push({MsgType:a,MsgContent:u})}e.sess.type()==T.C2C?Ye.apiCall(c,"sendmsg",o,t,n):e.sess.type()==T.GROUP&&Ye.apiCall(l,"send_group_msg",o,t,n)}}(e,function(o){if(e.sess.type()==T.C2C){if(!Ze.addMsg(e)){var i="sendMsg: addMsg failed!",r=ye.getReturnError(i,-17);return Me.error(i),void(n&&n(r))}Ze.updateTimeline()}t&&t(o)},function(e){n&&n(e)})}},et=new function(){this.fileMd5=null;this.submitUploadFileForm=function(e,t,n){var o,i,r=e.formId,s=e.fileId,u="uploadResultIframe_"+oe++,a=e.To_Account,c=e.businessType,l=document.getElementById(r);if(!l)return o="获取表单对象为空: formId="+r+"(formId非法)",i=ye.getReturnError(o,-20),void(n&&n(i));var p=document.getElementById(s);if(!p)return o="获取文件对象为空: fileId="+s+"(没有选择文件或者fileId非法)",i=ye.getReturnError(o,-21),void(n&&n(i));p.name="file";var f=document.createElement("iframe");f.name=u,f.id=u,f.style.display="none",document.body.appendChild(f);var g="https://pic.tim.qq.com/v4/openpic/"+(Se()?"pic_up":"pic_up_test")+"?tinyid="+se.tinyid+"&a2="+se.a2+"&sdkappid="+se.sdkAppID+"&accounttype="+se.accountType+"&contenttype=http";function d(e,t){var n=document.createElement("input");n.type="hidden",n.name=e,n.value=t,l.appendChild(n)}l.action=g,l.method="post",l.target=u,d("App_Version",w.APP_VERSION),d("From_Account",se.identifier),d("To_Account",a),d("Seq",Ee().toString()),d("Timestamp",_e().toString()),d("Random",Te().toString()),d("Busi_Id",c),d("PkgFlag",F.RAW_DATA.toString()),d("Auth_Key",re),d("Server_Ver",w.SERVER_VERSION.toString()),d("File_Type",e.fileType),setTimeout(function e(){var o;try{o=JSON.parse(f.contentWindow.name)||{}}catch(e){o={}}o.ActionStatus?(f.src="about:blank",f.parentNode.removeChild(f),f=null,o.ActionStatus==A.OK?t&&t(o):n&&n(o)):setTimeout(e,100)},500),l.submit()},this.uploadFile=function(e,t,n){var o={init:function(e,t,n){var o=this;o.file=e.file,o.onProgressCallBack=e.onProgressCallBack,e.abortButton&&(e.abortButton.onclick=o.abortHandler),o.total=o.file.size,o.loaded=0,o.step=1105920,o.sliceSize=0,o.sliceOffset=0,o.timestamp=_e(),o.seq=Ee(),o.random=Te(),o.fromAccount=se.identifier,o.toAccount=e.To_Account,o.fileMd5=e.fileMd5,o.businessType=e.businessType,o.fileType=e.fileType,o.cbOk=t,o.cbErr=n,o.reader=new FileReader,o.blobSlice=File.prototype.mozSlice||File.prototype.webkitSlice||File.prototype.slice,o.reader.onloadstart=o.onLoadStart,o.reader.onprogress=o.onProgress,o.reader.onabort=o.onAbort,o.reader.onerror=o.onerror,o.reader.onload=o.onLoad,o.reader.onloadend=o.onLoadEnd},upload:function(){o.readBlob(0)},onLoadStart:function(){},onProgress:function(e){var t=o;t.loaded+=e.loaded,t.onProgressCallBack&&t.onProgressCallBack(t.loaded,t.total)},onAbort:function(){},onError:function(){},onLoad:function(e){var t=o;if(e.target.readyState==FileReader.DONE){var n=e.target.result,i=n.indexOf(",");-1!=i&&(n=n.substr(i+1));var r={From_Account:t.fromAccount,To_Account:t.toAccount,Busi_Id:t.businessType,File_Type:t.fileType,File_Str_Md5:t.fileMd5,PkgFlag:F.BASE64_DATA,File_Size:t.total,Slice_Offset:t.sliceOffset,Slice_Size:t.sliceSize,Slice_Data:n,Seq:t.seq,Timestamp:t.timestamp,Random:t.random},s=function(e){if(0==e.IsFinish)t.loaded=e.Next_Offset,t.loaded<t.total?t.readBlob(t.loaded):t.loaded=t.total;else if(t.cbOk){var n={ActionStatus:e.ActionStatus,ErrorCode:e.ErrorCode,ErrorInfo:e.ErrorInfo,File_UUID:e.File_UUID,File_Size:e.Next_Offset,URL_INFO:e.URL_INFO,Download_Flag:e.Download_Flag};t.fileType==R.FILE&&(n.URL_INFO=Ge(e.File_UUID,se.identifier,t.file.name)),t.cbOk(n)}$=0},u=function(e){$<20?($++,setTimeout(function(){He(r,s,u)},1e3)):t.cbErr(e)};He(r,s,u)}},onLoadEnd:function(){},readBlob:function(e){var t,n=o,i=n.file,r=e+n.step;r>n.total?(r=n.total,n.sliceSize=r-e):n.sliceSize=n.step,n.sliceOffset=e,t=n.blobSlice.call(i,e,r),n.reader.readAsDataURL(t)},abortHandler:function(){var e=o;e.reader&&e.reader.abort()}};!function(e,t,n){var o=null;try{o=new FileReader}catch(e){if(n)return void n(ye.getReturnError("当前浏览器不支持FileReader",-18))}var i=File.prototype.mozSlice||File.prototype.webkitSlice||File.prototype.slice;if(i||!n){var r=2097152,s=Math.ceil(e.size/r),u=0,a=new SparkMD5;o.onload=function(e){for(var n="",o=new Uint8Array(e.target.result),i=o.byteLength,r=0;r<i;r++)n+=String.fromCharCode(o[r]);a.appendBinary(n),++u<s?c():(this.fileMd5=a.end(),t&&t(this.fileMd5))},c()}else n(ye.getReturnError("当前浏览器不支持FileAPI",-19));function c(){var t=u*r,n=t+r>=e.size?e.size:t+r,s=i.call(e,t,n);o.readAsArrayBuffer(s)}}(e.file,function(i){Me.info("fileMd5: "+i),e.fileMd5=i,o.init(e,t,n),o.upload()},n)}};e.SESSION_TYPE=T,e.MSG_MAX_LENGTH={C2C:12e3,GROUP:8898},e.C2C_MSG_SUB_TYPE=P,e.GROUP_MSG_SUB_TYPE=D,e.MSG_ELEMENT_TYPE=C,e.GROUP_TIP_TYPE=B,e.IMAGE_TYPE=v,e.GROUP_SYSTEM_TYPE=H,e.FRIEND_NOTICE_TYPE=J,e.GROUP_TIP_MODIFY_GROUP_INFO_TYPE=K,e.BROWSER_INFO=u,e.Emotions=e.EmotionPicData=Ie,e.EmotionDataIndexs=e.EmotionPicDataIndex=he,e.TLS_ERROR_CODE={OK:0,SIGNATURE_EXPIRATION:11},e.CONNECTION_STATUS=z,e.UPLOAD_PIC_BUSSINESS_TYPE={GROUP_MSG:1,C2C_MSG:2,USER_HEAD:3,GROUP_HEAD:4},e.RECENT_CONTACT_TYPE={C2C:1,GROUP:2},e.UPLOAD_RES_TYPE=R,e.Tool=ye,e.Log=Me,e.Msg=Qe,e.Session=je,e.MsgStore={sessMap:function(){return Ze.sessMap()},sessCount:function(){return Ze.sessCount()},sessByTypeId:function(e,t){return Ze.sessByTypeId(e,t)},delSessByTypeId:function(e,t){return Ze.delSessByTypeId(e,t)},resetCookieAndSyncFlag:function(){return Ze.resetCookieAndSyncFlag()}},e.Resources=me,e.login=e.init=function(e,t,o,i,s){Ye.init(t.onConnNotify,i,s),t.jsonpCallback&&(ne=t.jsonpCallback),function(e,t,o,i,s){be(),o&&(ue=o),0==ue.isAccessFormalEnv&&(Me.error("请切换为正式环境！！！！"),n=ue.isAccessFormalEnv),0==ue.isLogOn&&Me.setOn(ue.isLogOn),void 0!==ue.xssFilterEnable&&(r=ue.xssFilterEnable),e||!s?e.sdkAppID||!s?e.accountType||!s?(e.identifier&&(se.identifier=e.identifier.toString()),e.identifier&&!e.userSig&&s?s(ye.getReturnError("loginInfo.userSig is empty",-9)):(e.userSig&&(se.userSig=e.userSig.toString()),se.sdkAppID=e.sdkAppID,se.accountType=e.accountType,se.identifier&&se.userSig?Re(function(){we(function(e,n){$e.init(t,function(t){i&&(t.identifierNick=e,t.headurl=n,i(t))},s)},s)}):$e.init(t,i,s))):s(ye.getReturnError("loginInfo.accountType is empty",-8)):s(ye.getReturnError("loginInfo.sdkAppID is empty",-7)):s(ye.getReturnError("loginInfo is empty",-6))}(e,t,o,i,s)},e.logout=e.offline=function(e,t){return Le("instance",e,t)},e.logoutAll=function(e,t){return Le("all",e,t)},e.sendMsg=function(e,t,n){return $e.sendMsg(e,t,n)},e.syncMsgs=function(e,t){return $e.syncMsgs(e,t)},e.getC2CHistoryMsgs=function(e,t,n){return $e.getC2CHistoryMsgs(e,t,n)},e.syncGroupMsgs=function(e,t,n){return $e.syncGroupMsgs(e,t,n)},e.c2CMsgReaded=function(e,t,n){return Ze.c2CMsgReaded(e,t,n)},e.groupMsgReaded=function(e,t,n){return xe(e,t,n)},e.setAutoRead=function(e,t,n){return Ze.setAutoRead(e,t,n)},e.createGroup=function(e,t,n){return function(e,t,n){if(ve(n,!0)){for(var o={Type:e.Type,Name:e.Name},i=[],r=0;r<e.MemberList.length;r++)i.push({Member_Account:e.MemberList[r]});o.MemberList=i,e.GroupId&&(o.GroupId=e.GroupId),e.Owner_Account&&(o.Owner_Account=e.Owner_Account),e.Introduction&&(o.Introduction=e.Introduction),e.Notification&&(o.Notification=e.Notification),e.MaxMemberCount&&(o.MaxMemberCount=e.MaxMemberCount),e.ApplyJoinOption&&(o.ApplyJoinOption=e.ApplyJoinOption),e.AppDefinedData&&(o.AppDefinedData=e.AppDefinedData),e.FaceUrl&&(o.FaceUrl=e.FaceUrl),Ye.apiCall(l,"create_group",o,t,n)}}(e,t,n)},e.createGroupHigh=function(e,t,n){return function(e,t,n){ve(n,!0)&&Ye.apiCall(l,"create_group",e,t,n)}(e,t,n)},e.applyJoinGroup=function(e,t,n){return function(e,t,n){ve(n,!0)&&(e.GroupId=String(e.GroupId),Ye.apiCall(l,"apply_join_group",{GroupId:e.GroupId,ApplyMsg:e.ApplyMsg,UserDefinedField:e.UserDefinedField},t,n))}(e,t,n)},e.handleApplyJoinGroupPendency=function(e,t,n){return function(e,t,n){ve(n,!0)&&Ye.apiCall(l,"handle_apply_join_group",{GroupId:e.GroupId,Applicant_Account:e.Applicant_Account,HandleMsg:e.HandleMsg,Authentication:e.Authentication,MsgKey:e.MsgKey,ApprovalMsg:e.ApprovalMsg,UserDefinedField:e.UserDefinedField},t,function(e){if(10024==e.ErrorCode){if(t){var o={ActionStatus:A.OK,ErrorCode:0,ErrorInfo:"该申请已经被处理过"};t(o)}}else n&&n(e)})}(e,t,n)},e.getPendencyGroup=function(e,t,n){return function(e,t,n){ve(n,!0)&&Ye.apiCall(l,"get_pendency",{StartTime:e.StartTime,Limit:e.Limit,Handle_Account:se.identifier},t,function(e){})}(e,t,n)},e.getPendencyGroupRead=function(e,t,n){return function(e,t,n){ve(n,!0)&&Ye.apiCall(l,"report_pendency",{ReportTime:e.ReportTime,From_Account:se.identifier},t,function(e){})}(e,t,n)},e.handleInviteJoinGroupRequest=function(e,t,n){return function(e,t,n){ve(n,!0)&&Ye.apiCall(l,"handle_invite_join_group",{GroupId:e.GroupId,Inviter_Account:e.Inviter_Account,HandleMsg:e.HandleMsg,Authentication:e.Authentication,MsgKey:e.MsgKey,ApprovalMsg:e.ApprovalMsg,UserDefinedField:e.UserDefinedField},t,function(e){})}(e,t,n)},e.deleteApplyJoinGroupPendency=function(e,t,n){return function(e,t,n){ve(n,!0)&&Ye.apiCall(c,"deletemsg",e,t,n)}(e,t,n)},e.quitGroup=function(e,t,n){return function(e,t,n){ve(n,!0)&&Ye.apiCall(l,"quit_group",{GroupId:e.GroupId},t,n)}(e,t,n)},e.searchGroupByName=function(e,t,n){return function(e,t,n){Ye.apiCall(l,"search_group",e,t,n)}(e,t,n)},e.getGroupPublicInfo=function(e,t,n){return function(e,t,n){ve(n,!0)&&Ye.apiCall(l,"get_group_public_info",{GroupIdList:e.GroupIdList,ResponseFilter:{GroupBasePublicInfoFilter:e.GroupBasePublicInfoFilter}},function(e){if(e.ErrorInfo="",e.GroupInfo)for(var o in e.GroupInfo){var i=e.GroupInfo[o].ErrorCode;i>0&&(e.ActionStatus=A.FAIL,e.GroupInfo[o].ErrorInfo="["+i+"]"+e.GroupInfo[o].ErrorInfo,e.ErrorInfo+=e.GroupInfo[o].ErrorInfo+"\n")}e.ActionStatus==A.FAIL?n&&n(e):t&&t(e)},n)}(e,t,n)},e.getGroupInfo=function(e,t,n){return function(e,t,n){if(ve(n,!0)){var o={GroupIdList:e.GroupIdList,ResponseFilter:{GroupBaseInfoFilter:e.GroupBaseInfoFilter,MemberInfoFilter:e.MemberInfoFilter}};e.AppDefinedDataFilter_Group&&(o.ResponseFilter.AppDefinedDataFilter_Group=e.AppDefinedDataFilter_Group),e.AppDefinedDataFilter_GroupMember&&(o.ResponseFilter.AppDefinedDataFilter_GroupMember=e.AppDefinedDataFilter_GroupMember),Ye.apiCall(l,"get_group_info",o,t,n)}}(e,t,n)},e.modifyGroupBaseInfo=function(e,t,n){return function(e,t,n){ve(n,!0)&&Ye.apiCall(l,"modify_group_base_info",e,t,n)}(e,t,n)},e.getGroupMemberInfo=function(e,t,n){return function(e,t,n){ve(n,!0)&&Ye.apiCall(l,"get_group_member_info",{GroupId:e.GroupId,Offset:e.Offset,Limit:e.Limit,MemberInfoFilter:e.MemberInfoFilter,MemberRoleFilter:e.MemberRoleFilter,AppDefinedDataFilter_GroupMember:e.AppDefinedDataFilter_GroupMember},t,n)}(e,t,n)},e.addGroupMember=function(e,t,n){return function(e,t,n){ve(n,!0)&&Ye.apiCall(l,"add_group_member",{GroupId:e.GroupId,Silence:e.Silence,MemberList:e.MemberList},t,n)}(e,t,n)},e.modifyGroupMember=function(e,t,n){return function(e,t,n){if(ve(n,!0)){var o={};e.GroupId&&(o.GroupId=e.GroupId),e.Member_Account&&(o.Member_Account=e.Member_Account),e.Role&&(o.Role=e.Role),e.MsgFlag&&(o.MsgFlag=e.MsgFlag),e.ShutUpTime&&(o.ShutUpTime=e.ShutUpTime),e.NameCard&&(o.NameCard=e.NameCard),e.AppMemberDefinedData&&(o.AppMemberDefinedData=e.AppMemberDefinedData),Ye.apiCall(l,"modify_group_member_info",o,t,n)}}(e,t,n)},e.deleteGroupMember=function(e,t,n){return function(e,t,n){ve(n,!0)&&Ye.apiCall(l,"delete_group_member",{GroupId:e.GroupId,Silence:e.Silence,MemberToDel_Account:e.MemberToDel_Account,Reason:e.Reason},t,n)}(e,t,n)},e.destroyGroup=function(e,t,n){return function(e,t,n){ve(n,!0)&&Ye.apiCall(l,"destroy_group",{GroupId:e.GroupId},t,n)}(e,t,n)},e.changeGroupOwner=function(e,t,n){return function(e,t,n){ve(n,!0)&&Ye.apiCall(l,"change_group_owner",e,t,n)}(e,t,n)},e.getJoinedGroupListHigh=function(e,t,n){return qe(e,t,n)},e.getRoleInGroup=function(e,t,n){return function(e,t,n){ve(n,!0)&&Ye.apiCall(l,"get_role_in_group",{GroupId:e.GroupId,User_Account:e.User_Account},t,n)}(e,t,n)},e.forbidSendMsg=function(e,t,n){return function(e,t,n){ve(n,!0)&&Ye.apiCall(l,"forbid_send_msg",{GroupId:e.GroupId,Members_Account:e.Members_Account,ShutUpTime:e.ShutUpTime},t,n)}(e,t,n)},e.sendCustomGroupNotify=function(e,t,n){return function(e,t,n){ve(n,!0)&&Ye.apiCall(l,"send_group_system_notification",e,t,n)}(e,t,n)},e.applyJoinBigGroup=function(e,t,n){return function(e,t,n){var o;e.GroupId=String(e.GroupId),o=ve(n,!1)?l:m,$e.checkBigGroupLongPollingOn(e.GroupId)?n&&n(ye.getReturnError("Join Group failed; You have already been in this group, you have to quit group before you rejoin",10013)):Ye.apiCall(o,"apply_join_group",{GroupId:e.GroupId,ApplyMsg:e.ApplyMsg,UserDefinedField:e.UserDefinedField},function(o){if(o.JoinedStatus&&"JoinedSuccess"==o.JoinedStatus){if(!o.LongPollingKey)return void(n&&n(ye.getReturnError("Join Group succeed; But the type of group is not AVChatRoom: groupid="+e.GroupId,-12)));$e.setBigGroupLongPollingOn(!0),$e.setBigGroupLongPollingKey(e.GroupId,o.LongPollingKey),$e.setBigGroupLongPollingMsgMap(e.GroupId,0),$e.bigGroupLongPolling(e.GroupId)}t&&t(o)},function(e){n&&n(e)})}(e,t,n)},e.quitBigGroup=function(e,t,n){return function(e,t,n){var o;o=ve(n,!1)?l:m,$e.resetBigGroupLongPollingInfo(e.GroupId),Ye.apiCall(o,"quit_group",{GroupId:e.GroupId},function(n){Ze.delSessByTypeId(T.GROUP,e.GroupId),t&&t(n)},n)}(e,t,n)},e.getProfilePortrait=function(e,t,n){return Ke(e,t,n)},e.setProfilePortrait=function(e,t,n){return function(e,t,n){ve(n,!0)&&Ye.apiCall(f,"portrait_set",{From_Account:se.identifier,ProfileItem:e.ProfileItem},function(n){for(var o in e.ProfileItem){var i=e.ProfileItem[o];if("Tag_Profile_IM_Nick"==i.Tag){se.identifierNick=i.Value;break}}t&&t(n)},n)}(e,t,n)},e.applyAddFriend=function(e,t,n){return function(e,t,n){ve(n,!0)&&Ye.apiCall(p,"friend_add",{From_Account:se.identifier,AddFriendItem:e.AddFriendItem},function(e){var o=Be(e);o.ActionStatus==A.FAIL?n&&n(o):t&&t(o)},n)}(e,t,n)},e.getPendency=function(e,t,n){return function(e,t,n){ve(n,!0)&&Ye.apiCall(p,"pendency_get",{From_Account:se.identifier,PendencyType:e.PendencyType,StartTime:e.StartTime,MaxLimited:e.MaxLimited,LastSequence:e.LastSequence},t,n)}(e,t,n)},e.getPendencyReport=function(e,t,n){return function(e,t,n){ve(n,!0)&&Ye.apiCall(p,"PendencyReport",{From_Account:se.identifier,LatestPendencyTimeStamp:e.LatestPendencyTimeStamp},t,n)}(e,t,n)},e.deletePendency=function(e,t,n){return function(e,t,n){ve(n,!0)&&Ye.apiCall(p,"pendency_delete",{From_Account:se.identifier,PendencyType:e.PendencyType,To_Account:e.To_Account},function(e){var o=Be(e);o.ActionStatus==A.FAIL?n&&n(o):t&&t(o)},n)}(e,t,n)},e.responseFriend=function(e,t,n){return function(e,t,n){ve(n,!0)&&Ye.apiCall(p,"friend_response",{From_Account:se.identifier,ResponseFriendItem:e.ResponseFriendItem},function(e){var o=Be(e);o.ActionStatus==A.FAIL?n&&n(o):t&&t(o)},n)}(e,t,n)},e.getAllFriend=function(e,t,n){return function(e,t,n){ve(n,!0)&&Ye.apiCall(p,"friend_get_all",{From_Account:se.identifier,TimeStamp:e.TimeStamp,StartIndex:e.StartIndex,GetCount:e.GetCount,LastStandardSequence:e.LastStandardSequence,TagList:e.TagList},t,n)}(e,t,n)},e.deleteChat=function(e,t,n){return function(e,t,n){ve(n,!0)&&(1==e.chatType?Ye.apiCall(y,"delete",{From_Account:se.identifier,Type:e.chatType,To_Account:e.To_Account},t,n):Ye.apiCall(y,"delete",{From_Account:se.identifier,Type:e.chatType,ToGroupid:e.To_Account},t,n))}(e,t,n)},e.deleteFriend=function(e,t,n){return function(e,t,n){ve(n,!0)&&Ye.apiCall(p,"friend_delete",{From_Account:se.identifier,To_Account:e.To_Account,DeleteType:e.DeleteType},function(e){var o=Be(e);o.ActionStatus==A.FAIL?n&&n(o):t&&t(o)},n)}(e,t,n)},e.addBlackList=function(e,t,n){return function(e,t,n){ve(n,!0)&&Ye.apiCall(p,"black_list_add",{From_Account:se.identifier,To_Account:e.To_Account},function(e){var o=Be(e);o.ActionStatus==A.FAIL?n&&n(o):t&&t(o)},n)}(e,t,n)},e.deleteBlackList=function(e,t,n){return function(e,t,n){ve(n,!0)&&Ye.apiCall(p,"black_list_delete",{From_Account:se.identifier,To_Account:e.To_Account},function(e){var o=Be(e);o.ActionStatus==A.FAIL?n&&n(o):t&&t(o)},n)}(e,t,n)},e.getBlackList=function(e,t,n){return function(e,t,n){ve(n,!0)&&Ye.apiCall(p,"black_list_get",{From_Account:se.identifier,StartIndex:e.StartIndex,MaxLimited:e.MaxLimited,LastSequence:e.LastSequence},t,n)}(e,t,n)},e.getRecentContactList=function(e,t,n){return function(e,t,n){ve(n,!0)&&Ye.apiCall(g,"get",{From_Account:se.identifier,Count:e.Count},t,n)}(e,t,n)},e.uploadFile=e.uploadPic=function(e,t,n){return et.uploadFile(e,t,n)},e.submitUploadFileForm=function(e,t,n){return et.submitUploadFileForm(e,t,n)},e.uploadFileByBase64=e.uploadPicByBase64=function(e,t,n){var o={To_Account:e.toAccount,Busi_Id:e.businessType,File_Type:e.File_Type,File_Str_Md5:e.fileMd5,PkgFlag:F.BASE64_DATA,File_Size:e.totalSize,Slice_Offset:0,Slice_Size:e.totalSize,Slice_Data:e.base64Str,Seq:Ee(),Timestamp:_e(),Random:Te()};return He(o,t,n)},e.setJsonpLastRspData=function(e){te="string"==typeof e?JSON.parse(e):e},e.getLongPollingId=function(e,t,n){return Ve(0,t,n)},e.applyDownload=function(e,t,n){return ze(e,t,n)},e.onDownFile=function(e){window.open(me.downloadMap["uuid_"+e])},e.checkLogin=function(e,t){return ve(e,t)}}(r)}]);